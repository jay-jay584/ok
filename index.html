<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NetSphere - Social Platform</title>
  <!-- Critical for GitHub Pages subfolders -->
  <base href="./">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #F6F6F6;
      --dark: #0B0B0B;
      --accent: #38E06B;
      --text: #0B0B0B;
      --text-sec: #6E6E6E;
      --danger: #ef4444;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
    }
    h1, h2, h3 { font-family: 'Poppins', sans-serif; }
    
    /* Loading State */
    #loading {
      position: fixed;
      inset: 0;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .spinner {
      width: 40px; height: 40px;
      border: 3px solid rgba(56,224,107,0.3);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* Navigation */
    .nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: rgba(246,246,246,0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0,0,0,0.05);
      z-index: 100;
      padding: 0 20px;
    }
    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 60px;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      cursor: pointer;
    }
    .logo-icon {
      width: 40px; height: 40px;
      background: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: var(--dark);
    }
    .logo-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--dark);
    }
    .nav-links {
      display: flex;
      gap: 8px;
    }
    .nav-link {
      padding: 8px 16px;
      border-radius: 20px;
      text-decoration: none;
      color: var(--text-sec);
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
      border: none;
      background: transparent;
      font-family: inherit;
      font-size: 0.95rem;
    }
    .nav-link:hover, .nav-link.active {
      background: rgba(0,0,0,0.05);
      color: var(--dark);
    }
    .nav-link.dev { color: var(--accent); }
    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
    }
    
    /* Layout */
    .main {
      padding-top: 80px;
      max-width: 600px;
      margin: 0 auto;
      padding-bottom: 40px;
      padding-left: 20px;
      padding-right: 20px;
    }
    .main.wide { max-width: 1000px; }
    
    /* Cards */
    .card {
      background: white;
      border-radius: 24px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Buttons */
    .btn {
      background: var(--accent);
      color: var(--dark);
      border: none;
      padding: 12px 24px;
      border-radius: 24px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(56,224,107,0.4);
    }
    .btn:active { transform: translateY(0); }
    .btn-outline {
      background: transparent;
      border: 2px solid var(--dark);
      color: var(--dark);
    }
    .btn-outline:hover {
      background: var(--dark);
      color: white;
    }
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    .btn-danger:hover { box-shadow: 0 4px 16px rgba(239,68,68,0.4); }
    .btn-small {
      padding: 6px 12px;
      font-size: 0.875rem;
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Forms */
    input, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 16px;
      font-size: 1rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s;
    }
    input:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(56,224,107,0.1);
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      font-size: 0.875rem;
    }
    .error-msg {
      background: #fee2e2;
      color: #dc2626;
      padding: 12px 16px;
      border-radius: 12px;
      margin-bottom: 16px;
      font-size: 0.875rem;
      display: none;
    }
    .error-msg.show { display: block; }
    
    /* Auth Pages */
    .auth-page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .auth-card {
      background: white;
      border-radius: 32px;
      padding: 40px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.1);
    }
    .auth-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .auth-header .logo-icon {
      margin: 0 auto 16px;
      width: 60px; height: 60px;
      font-size: 1.5rem;
    }
    .dev-hint {
      background: rgba(56,224,107,0.1);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 20px;
      font-size: 0.875rem;
    }
    .dev-hint h4 {
      color: var(--accent);
      margin-bottom: 8px;
    }
    
    /* Posts */
    .post-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    .avatar {
      width: 48px; height: 48px;
      border-radius: 50%;
      object-fit: cover;
      background: linear-gradient(135deg,var(--accent),#2bc55a);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
      flex-shrink: 0;
    }
    .avatar.small {
      width: 32px; height: 32px;
      font-size: 0.875rem;
    }
    .post-meta h4 {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .post-meta span {
      color: var(--text-sec);
      font-size: 0.875rem;
    }
    .verified {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px; height: 16px;
      background: #3b82f6;
      color: white;
      border-radius: 50%;
      font-size: 10px;
    }
    .post-content {
      margin-bottom: 16px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .post-media {
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 16px;
      background: #f0f0f0;
    }
    .post-media img, .post-media video {
      width: 100%;
      max-height: 400px;
      object-fit: cover;
      display: block;
    }
    .post-actions {
      display: flex;
      gap: 20px;
      padding-top: 12px;
      border-top: 1px solid rgba(0,0,0,0.05);
    }
    .post-action {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--text-sec);
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
      padding: 4px 8px;
      border-radius: 12px;
    }
    .post-action:hover {
      background: rgba(0,0,0,0.03);
      color: var(--accent);
    }
    .post-action.liked {
      color: var(--danger);
    }
    .post-action.delete:hover {
      color: var(--danger);
      background: rgba(239,68,68,0.05);
    }
    
    /* Create Post */
    .create-post {
      display: flex;
      gap: 12px;
    }
    .create-post textarea {
      flex: 1;
      border: none;
      background: transparent;
      min-height: 60px;
      padding: 0;
    }
    .create-post textarea:focus {
      box-shadow: none;
    }
    .create-post-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(0,0,0,0.05);
    }
    .media-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 20px;
      color: var(--text-sec);
      cursor: pointer;
      transition: background 0.2s;
      font-size: 0.875rem;
      font-weight: 500;
    }
    .media-btn:hover {
      background: rgba(0,0,0,0.05);
    }
    .media-preview-container {
      margin-top: 12px;
      position: relative;
      display: inline-block;
    }
    .media-preview-container img,
    .media-preview-container video {
      max-height: 200px;
      border-radius: 12px;
      display: block;
    }
    .remove-media {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(0,0,0,0.6);
      color: white;
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      line-height: 1;
    }
    .remove-media:hover {
      background: rgba(0,0,0,0.8);
    }
    
    /* Comments */
    .comments-section {
      display: none;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(0,0,0,0.05);
    }
    .comments-section.show { display: block; }
    .comment {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      animation: fadeIn 0.3s ease;
    }
    .comment-content {
      background: rgba(0,0,0,0.03);
      padding: 8px 12px;
      border-radius: 12px;
      flex: 1;
    }
    .comment-author {
      font-weight: 600;
      font-size: 0.875rem;
      margin-bottom: 2px;
    }
    .comment-text {
      font-size: 0.875rem;
      margin: 0;
    }
    .comment-input-wrapper {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }
    
    /* Profile */
    .profile-header {
      position: relative;
      overflow: hidden;
    }
    .cover-image {
      height: 200px;
      background: linear-gradient(135deg, var(--accent), #2bc55a);
      border-radius: 24px 24px 0 0;
    }
    .profile-info {
      padding: 0 24px 24px;
    }
    .profile-avatar {
      width: 120px; height: 120px;
      border-radius: 50%;
      border: 4px solid white;
      margin-top: -60px;
      background: linear-gradient(135deg,var(--accent),#2bc55a);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 3rem;
      font-weight: bold;
    }
    .profile-name {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
    }
    .profile-name h1 {
      font-size: 1.5rem;
    }
    .profile-handle {
      color: var(--text-sec);
      margin-top: 4px;
    }
    .profile-bio {
      margin-top: 12px;
      line-height: 1.5;
    }
    .profile-stats {
      display: flex;
      gap: 24px;
      margin-top: 16px;
    }
    .profile-stats > div {
      text-align: center;
      cursor: pointer;
      padding: 8px;
      border-radius: 12px;
      transition: background 0.2s;
    }
    .profile-stats > div:hover {
      background: rgba(0,0,0,0.03);
    }
    .profile-stats strong {
      display: block;
      font-size: 1.25rem;
      color: var(--dark);
    }
    .profile-stats span {
      color: var(--text-sec);
      font-size: 0.875rem;
    }
    
    /* Dev Panel */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: white;
      border-radius: 20px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    .stat-card h3 {
      font-size: 2rem;
      color: var(--accent);
    }
    .stat-card p {
      color: var(--text-sec);
      font-size: 0.875rem;
      margin-top: 4px;
    }
    .user-table-wrapper {
      overflow-x: auto;
      border-radius: 16px;
      background: white;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    .user-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }
    .user-table th, .user-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .user-table th {
      color: var(--text-sec);
      font-weight: 600;
      background: rgba(0,0,0,0.02);
    }
    .user-table tr:hover {
      background: rgba(0,0,0,0.02);
    }
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .badge-dev { background: rgba(56,224,107,0.2); color: #16a34a; }
    .badge-fake { background: rgba(168,85,247,0.2); color: #a855f7; }
    .badge-banned { background: rgba(239,68,68,0.2); color: #dc2626; }
    .badge-verified { background: rgba(59,130,246,0.2); color: #2563eb; }
    .online-dot {
      width: 8px; height: 8px;
      background: var(--accent);
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }
    .offline-dot {
      width: 8px; height: 8px;
      background: #9ca3af;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }
    .modal {
      background: white;
      border-radius: 24px;
      padding: 24px;
      width: 100%;
      max-width: 400px;
      transform: scale(0.9);
      transition: transform 0.3s;
    }
    .modal-overlay.show .modal {
      transform: scale(1);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-sec);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }
    .modal-close:hover {
      background: rgba(0,0,0,0.05);
    }
    
    /* Empty States */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-sec);
    }
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    /* Toast Notifications */
    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 300;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .toast {
      background: var(--dark);
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      animation: slideIn 0.3s ease;
      max-width: 300px;
      font-size: 0.875rem;
    }
    .toast.error { background: var(--danger); }
    .toast.success { background: var(--accent); color: var(--dark); font-weight: 500; }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .nav-links {
        display: none;
        position: absolute;
        top: 60px;
        left: 0;
        right: 0;
        background: var(--bg);
        flex-direction: column;
        padding: 20px;
        gap: 8px;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }
      .nav-links.show { display: flex; }
      .mobile-menu-btn { display: block; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .auth-card { padding: 24px; }
      .profile-stats { gap: 16px; }
      .profile-stats > div { padding: 4px; }
    }
    
    /* Utility */
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mt-2 { margin-top: 8px; }
    .mt-4 { margin-top: 16px; }
    .flex { display: flex; }
    .gap-2 { gap: 8px; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
  </style>
<base target="_blank">
</head>
<body>
  <div id="loading">
    <div class="spinner"></div>
    <p>Loading NetSphere...</p>
  </div>
  
  <div id="app" style="display:none;">
    <!-- Content injected here -->
  </div>
  
  <div class="toast-container" id="toast-container"></div>

  <script>
    // ==========================================
    // NetSphere - GitHub Pages Compatible Version
    // Uses Hash Routing (#/) for SPA functionality
    // ==========================================
    
    'use strict';
    
    // Database Module
    const DB = {
      KEYS: {
        USERS: 'ns_users_v2',
        POSTS: 'ns_posts_v2',
        CURRENT_USER: 'ns_current_user_v2'
      },
      
      getUsers() {
        try {
          return JSON.parse(localStorage.getItem(this.KEYS.USERS)) || [];
        } catch(e) {
          console.error('Error loading users:', e);
          return [];
        }
      },
      
      getPosts() {
        try {
          return JSON.parse(localStorage.getItem(this.KEYS.POSTS)) || [];
        } catch(e) {
          console.error('Error loading posts:', e);
          return [];
        }
      },
      
      getCurrentUser() {
        try {
          return JSON.parse(localStorage.getItem(this.KEYS.CURRENT_USER));
        } catch(e) {
          return null;
        }
      },
      
      saveUsers(users) {
        localStorage.setItem(this.KEYS.USERS, JSON.stringify(users));
      },
      
      savePosts(posts) {
        localStorage.setItem(this.KEYS.POSTS, JSON.stringify(posts));
      },
      
      saveCurrentUser(user) {
        localStorage.setItem(this.KEYS.CURRENT_USER, JSON.stringify(user));
      },
      
      init() {
        const users = this.getUsers();
        // Create dev account if missing
        if (!users.find(u => u.username === 'jayjay')) {
          users.push({
            id: 'dev-' + Date.now(),
            username: 'jayjay',
            email: 'dev@netsphere.com',
            password: '2012!',
            displayName: 'JayJay (Dev)',
            bio: 'NetSphere Developer & Admin üöÄ',
            avatar: null,
            cover: null,
            isVerified: true,
            isAdmin: true,
            isDev: true,
            isOnline: true,
            status: 'online',
            createdAt: new Date().toISOString(),
            followers: [],
            following: [],
            posts: 0,
            banned: false,
            banReason: null
          });
          this.saveUsers(users);
          console.log('Dev account created: jayjay / 2012!');
        }
      }
    };
    
    // Initialize DB
    DB.init();
    
    // State Management
    let currentUser = DB.getCurrentUser();
    let currentMediaFile = null;
    
    // Utility Functions
    const Utils = {
      generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
      },
      
      formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);
        
        if (minutes < 1) return 'Just now';
        if (minutes < 60) return `${minutes}m ago`;
        if (hours < 24) return `${hours}h ago`;
        if (days < 7) return `${days}d ago`;
        return date.toLocaleDateString();
      },
      
      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      },
      
      showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }
    };
    
    // Router - Hash based for GitHub Pages compatibility
    const Router = {
      routes: {},
      
      add(path, handler) {
        this.routes[path] = handler;
      },
      
      navigate(path) {
        window.location.hash = path;
      },
      
      handle() {
        const hash = window.location.hash.slice(1) || '/';
        const [route, ...params] = hash.split('/');
        
        // Check auth
        if (!currentUser && route !== 'login' && route !== 'register') {
          this.navigate('login');
          return;
        }
        
        if (currentUser && (route === 'login' || route === 'register')) {
          this.navigate('/');
          return;
        }
        
        // Route handlers
        switch(route) {
          case 'login':
            Views.showLogin();
            break;
          case 'register':
            Views.showRegister();
            break;
          case 'profile':
            Views.showProfile(params[0] || currentUser.username);
            break;
          case 'dev':
            if (currentUser?.isDev) Views.showDevPanel();
            else this.navigate('/');
            break;
          case '':
          case '/':
          case 'home':
            Views.showHome();
            break;
          default:
            Views.showHome();
        }
        
        this.updateNavActive(route || 'home');
      },
      
      updateNavActive(route) {
        document.querySelectorAll('.nav-link').forEach(link => {
          link.classList.remove('active');
          if (link.dataset.route === route) link.classList.add('active');
        });
      }
    };
    
    // Views
    const Views = {
      init() {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        
        if (currentUser) {
          // Update online status
          const users = DB.getUsers();
          const idx = users.findIndex(u => u.id === currentUser.id);
          if (idx !== -1) {
            users[idx].isOnline = true;
            users[idx].lastActive = new Date().toISOString();
            DB.saveUsers(users);
            currentUser = users[idx];
            DB.saveCurrentUser(currentUser);
          }
          Router.handle();
        } else {
          Router.navigate('login');
        }
      },
      
      renderNav() {
        const isDev = currentUser?.isDev;
        return `
          <nav class="nav">
            <div class="nav-inner">
              <div class="logo" data-route="home">
                <div class="logo-icon">N</div>
                <span class="logo-text">NetSphere</span>
              </div>
              <button class="mobile-menu-btn" onclick="document.querySelector('.nav-links').classList.toggle('show')">‚ò∞</button>
              <div class="nav-links">
                <button class="nav-link ${!window.location.hash || window.location.hash === '#/' ? 'active' : ''}" data-route="home" onclick="Router.navigate('/')">Home</button>
                <button class="nav-link" data-route="profile" onclick="Router.navigate('profile/${currentUser.username}')">Profile</button>
                ${isDev ? `<button class="nav-link dev" data-route="dev" onclick="Router.navigate('dev')">Dev</button>` : ''}
                <button class="nav-link" onclick="Auth.logout()">Logout</button>
              </div>
            </div>
          </nav>
        `;
      },
      
      showLogin() {
        document.getElementById('app').innerHTML = `
          <div class="auth-page">
            <div class="auth-card">
              <div class="auth-header">
                <div class="logo-icon">N</div>
                <h1>NetSphere</h1>
                <p>Welcome back!</p>
              </div>
              
              <div class="dev-hint">
                <strong>üë®‚Äçüíª Dev Account</strong><br>
                Username: <code>jayjay</code><br>
                Password: <code>2012!</code>
                <button class="btn btn-small mt-2" onclick="document.getElementById('login-username').value='jayjay';document.getElementById('login-password').value='2012!'" style="width:100%;">Auto-fill Credentials</button>
              </div>
              
              <div id="login-error" class="error-msg"></div>
              
              <form id="login-form">
                <div class="form-group">
                  <label>Username or Email</label>
                  <input type="text" id="login-username" required autofocus>
                </div>
                <div class="form-group">
                  <label>Password</label>
                  <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn" style="width:100%;">Log In</button>
              </form>
              
              <p class="text-center mt-4" style="color:var(--text-sec);">
                Don't have an account? 
                <a href="#register" style="color:var(--accent); font-weight:600;">Sign up</a>
              </p>
            </div>
          </div>
        `;
        
        document.getElementById('login-form').addEventListener('submit', Auth.handleLogin);
      },
      
      showRegister() {
        document.getElementById('app').innerHTML = `
          <div class="auth-page">
            <div class="auth-card">
              <div class="auth-header">
                <div class="logo-icon">N</div>
                <h1>Create Account</h1>
                <p>Join NetSphere today</p>
              </div>
              
              <div id="register-error" class="error-msg"></div>
              
              <form id="register-form">
                <div class="form-group">
                  <label>Username *</label>
                  <input type="text" id="reg-username" required pattern="[a-zA-Z0-9_]+" title="Letters, numbers, underscores only">
                </div>
                <div class="form-group">
                  <label>Email *</label>
                  <input type="email" id="reg-email" required>
                </div>
                <div class="form-group">
                  <label>Display Name</label>
                  <input type="text" id="reg-display" placeholder="Your name">
                </div>
                <div class="form-group">
                  <label>Password *</label>
                  <input type="password" id="reg-password" required minlength="6">
                </div>
                <div class="form-group">
                  <label>Confirm Password *</label>
                  <input type="password" id="reg-confirm" required>
                </div>
                <button type="submit" class="btn" style="width:100%;">Create Account</button>
              </form>
              
              <p class="text-center mt-4" style="color:var(--text-sec);">
                Already have an account? 
                <a href="#login" style="color:var(--accent); font-weight:600;">Log in</a>
              </p>
            </div>
          </div>
        `;
        
        document.getElementById('register-form').addEventListener('submit', Auth.handleRegister);
      },
      
      showHome() {
        const posts = DB.getPosts().sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        
        document.getElementById('app').innerHTML = `
          ${this.renderNav()}
          <main class="main">
            <div class="card">
              <div style="display:flex; align-items:center; gap:16px;">
                <div class="avatar" style="width:56px;height:56px;font-size:1.5rem;">
                  ${currentUser.displayName[0].toUpperCase()}
                </div>
                <div>
                  <h2>Welcome back, ${currentUser.displayName}!</h2>
                  ${currentUser.isDev ? '<span style="color:var(--accent); font-weight:600;">üë®‚Äçüíª Dev Mode Active</span>' : ''}
                </div>
              </div>
            </div>
            
            <div class="card">
              <div class="create-post">
                <div class="avatar">${currentUser.displayName[0].toUpperCase()}</div>
                <div style="flex:1;">
                  <textarea id="post-content" placeholder="What's on your mind?"></textarea>
                  <div class="create-post-actions">
                    <label class="media-btn">
                      üì∑ Photo/Video
                      <input type="file" id="post-media" accept="image/*,video/*" style="display:none;">
                    </label>
                    <button class="btn" onclick="Posts.create()">Post</button>
                  </div>
                  <div id="media-preview"></div>
                </div>
              </div>
            </div>
            
            <div id="posts-container">
              ${posts.length === 0 ? 
                '<div class="card empty-state"><div class="empty-state-icon">üìù</div><p>No posts yet. Be the first to share something!</p></div>' : 
                posts.map(post => this.renderPost(post)).join('')}
            </div>
          </main>
        `;
        
        // Event listeners for media upload
        const mediaInput = document.getElementById('post-media');
        if (mediaInput) {
          mediaInput.addEventListener('change', Posts.previewMedia);
        }
      },
      
      renderPost(post) {
        const users = DB.getUsers();
        const author = users.find(u => u.id === post.userId) || {};
        const isLiked = post.likes.includes(currentUser?.id);
        const isOwner = post.userId === currentUser?.id || currentUser?.isDev;
        
        return `
          <div class="card" data-post-id="${post.id}">
            <div class="post-header">
              <div class="avatar" onclick="Router.navigate('profile/${author.username}')" style="cursor:pointer;">
                ${author.displayName?.[0]?.toUpperCase() || 'U'}
              </div>
              <div class="post-meta">
                <h4 onclick="Router.navigate('profile/${author.username}')" style="cursor:pointer;">
                  ${author.displayName || 'Unknown'} 
                  ${author.isVerified ? '<span class="verified">‚úì</span>' : ''}
                </h4>
                <span>@${author.username || 'unknown'} ¬∑ ${Utils.formatDate(post.createdAt)}</span>
              </div>
            </div>
            <p class="post-content">${Utils.escapeHtml(post.content)}</p>
            ${post.mediaUrl ? `
              <div class="post-media">
                ${post.type === 'video' 
                  ? `<video src="${post.mediaUrl}" controls></video>`
                  : `<img src="${post.mediaUrl}" alt="Post media">`
                }
              </div>
            ` : ''}
            <div class="post-actions">
              <div class="post-action ${isLiked ? 'liked' : ''}" onclick="Posts.like('${post.id}')">
                <span>${isLiked ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                <span>${post.likes.length}</span>
              </div>
              <div class="post-action" onclick="Posts.toggleComments('${post.id}')">
                <span>üí¨</span>
                <span>${post.comments.length}</span>
              </div>
              <div class="post-action">
                <span>üîÑ</span>
                <span>${post.shares || 0}</span>
              </div>
              ${isOwner ? `
                <div class="post-action delete" onclick="Posts.delete('${post.id}')" style="margin-left:auto;">
                  <span>üóëÔ∏è</span>
                </div>
              ` : ''}
            </div>
            <div class="comments-section" id="comments-${post.id}">
              ${post.comments.map(c => {
                const commenter = users.find(u => u.id === c.userId) || {};
                return `
                  <div class="comment">
                    <div class="avatar small">${commenter.displayName?.[0]?.toUpperCase() || 'U'}</div>
                    <div class="comment-content">
                      <div class="comment-author">${commenter.displayName || 'Unknown'}</div>
                      <p class="comment-text">${Utils.escapeHtml(c.content)}</p>
                    </div>
                  </div>
                `;
              }).join('')}
              <div class="comment-input-wrapper">
                <div class="avatar small">${currentUser.displayName[0].toUpperCase()}</div>
                <input type="text" id="comment-input-${post.id}" placeholder="Write a comment..." onkeypress="if(event.key==='Enter') Posts.comment('${post.id}')">
                <button class="btn btn-small" onclick="Posts.comment('${post.id}')">Post</button>
              </div>
            </div>
          </div>
        `;
      },
      
      showProfile(username) {
        const users = DB.getUsers();
        const profile = users.find(u => u.username === username);
        if (!profile) {
          Utils.showToast('User not found', 'error');
          Router.navigate('/');
          return;
        }
        
        const posts = DB.getPosts()
          .filter(p => p.userId === profile.id)
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        
        const isFollowing = profile.followers.includes(currentUser?.id);
        const isOwn = currentUser?.id === profile.id;
        
        document.getElementById('app').innerHTML = `
          ${this.renderNav()}
          <main class="main" style="max-width:800px;">
            <div class="card profile-header" style="padding:0;">
              <div class="cover-image"></div>
              <div class="profile-info">
                <div class="profile-avatar">
                  ${profile.displayName?.[0]?.toUpperCase() || 'U'}
                </div>
                <div class="profile-name">
                  <h1>${profile.displayName}</h1>
                  ${profile.isVerified ? '<span class="verified" style="width:20px;height:20px;">‚úì</span>' : ''}
                </div>
                <p class="profile-handle">@${profile.username}</p>
                ${profile.bio ? `<p class="profile-bio">${Utils.escapeHtml(profile.bio)}</p>` : ''}
                
                <div class="profile-stats">
                  <div>
                    <strong>${posts.length}</strong>
                    <span>Posts</span>
                  </div>
                  <div>
                    <strong>${profile.followers.length}</strong>
                    <span>Followers</span>
                  </div>
                  <div>
                    <strong>${profile.following.length}</strong>
                    <span>Following</span>
                  </div>
                </div>
                
                ${!isOwn ? `
                  <button class="btn ${isFollowing ? 'btn-outline' : ''} mt-4" onclick="Users.follow('${profile.id}')">
                    ${isFollowing ? 'Following' : 'Follow'}
                  </button>
                ` : ''}
              </div>
            </div>
            
            <h2 style="margin-bottom:16px;">Posts</h2>
            ${posts.length === 0 ? 
              '<div class="card empty-state"><p>No posts yet</p></div>' : 
              posts.map(post => this.renderPost(post)).join('')}
          </main>
        `;
      },
      
      showDevPanel() {
        const users = DB.getUsers();
        const posts = DB.getPosts();
        
        const stats = {
          totalUsers: users.length,
          totalPosts: posts.length,
          onlineUsers: users.filter(u => u.isOnline).length,
          verifiedUsers: users.filter(u => u.isVerified).length,
          bannedUsers: users.filter(u => u.banned).length
        };
        
        document.getElementById('app').innerHTML = `
          ${this.renderNav()}
          <main class="main wide">
            <div class="card">
              <div style="display:flex; align-items:center; gap:16px;">
                <div style="width:56px;height:56px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;">
                  üõ°Ô∏è
                </div>
                <div>
                  <h1>Developer Panel</h1>
                  <p style="color:var(--text-sec);">System Administration</p>
                </div>
              </div>
            </div>
            
            <div class="stats-grid">
              <div class="stat-card">
                <h3>${stats.totalUsers}</h3>
                <p>Total Users</p>
              </div>
              <div class="stat-card">
                <h3>${stats.onlineUsers}</h3>
                <p>Online Now</p>
              </div>
              <div class="stat-card">
                <h3>${stats.totalPosts}</h3>
                <p>Total Posts</p>
              </div>
              <div class="stat-card">
                <h3>${stats.bannedUsers}</h3>
                <p>Banned Users</p>
              </div>
            </div>
            
            <div style="display:flex; gap:12px; margin-bottom:20px;">
              <button class="btn" onclick="Dev.showCreateModal()">+ Create Test User</button>
              <button class="btn btn-outline" onclick="Router.navigate('dev')">üîÑ Refresh Data</button>
            </div>
            
            <div class="user-table-wrapper">
              <table class="user-table">
                <thead>
                  <tr>
                    <th>User</th>
                    <th>Status</th>
                    <th>Roles</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  ${users.map(u => `
                    <tr>
                      <td>
                        <div style="display:flex; align-items:center; gap:12px;">
                          <div class="avatar small">${u.displayName?.[0]?.toUpperCase()}</div>
                          <div>
                            <div style="font-weight:600;">${u.displayName}</div>
                            <div style="font-size:0.875rem; color:var(--text-sec);">@${u.username}</div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <span class="${u.isOnline ? 'online-dot' : 'offline-dot'}"></span>
                        <span style="font-size:0.875rem;">${u.isOnline ? 'Online' : 'Offline'}</span>
                      </td>
                      <td>
                        ${u.isDev ? '<span class="badge badge-dev">Dev</span>' : ''}
                        ${u.isVerified ? '<span class="badge badge-verified">Verified</span>' : ''}
                        ${u.banned ? '<span class="badge badge-banned">Banned</span>' : ''}
                      </td>
                      <td>
                        ${!u.isDev ? `
                          <div style="display:flex; gap:6px; flex-wrap:wrap;">
                            <button class="btn btn-small" onclick="Dev.verify('${u.id}', ${!u.isVerified})">
                              ${u.isVerified ? 'Unverify' : 'Verify'}
                            </button>
                            <button class="btn btn-small ${u.banned ? 'btn-danger' : ''}" onclick="Dev.ban('${u.id}', ${!u.banned})">
                              ${u.banned ? 'Unban' : 'Ban'}
                            </button>
                            <button class="btn btn-small btn-danger" onclick="Dev.deleteUser('${u.id}')">Delete</button>
                          </div>
                        ` : '<span style="color:var(--text-sec); font-size:0.875rem;">Protected Account</span>'}
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </main>
        `;
      }
    };
    
    // Auth Module
    const Auth = {
      handleLogin(e) {
        e.preventDefault();
        const username = document.getElementById('login-username').value;
        const password = document.getElementById('login-password').value;
        const errorDiv = document.getElementById('login-error');
        
        const users = DB.getUsers();
        const user = users.find(u => (u.username === username || u.email === username) && u.password === password);
        
        if (!user) {
          errorDiv.textContent = 'Invalid username or password';
          errorDiv.classList.add('show');
          return;
        }
        
        if (user.banned) {
          errorDiv.textContent = `Account banned: ${user.banReason}`;
          errorDiv.classList.add('show');
          return;
        }
        
        user.isOnline = true;
        user.lastActive = new Date().toISOString();
        DB.saveUsers(users);
        
        currentUser = user;
        DB.saveCurrentUser(user);
        Utils.showToast('Welcome back!', 'success');
        Router.navigate('/');
      },
      
      handleRegister(e) {
        e.preventDefault();
        const username = document.getElementById('reg-username').value;
        const email = document.getElementById('reg-email').value;
        const password = document.getElementById('reg-password').value;
        const confirm = document.getElementById('reg-confirm').value;
        const displayName = document.getElementById('reg-display').value;
        const errorDiv = document.getElementById('register-error');
        
        if (password !== confirm) {
          errorDiv.textContent = "Passwords don't match";
          errorDiv.classList.add('show');
          return;
        }
        
        const users = DB.getUsers();
        
        if (users.find(u => u.username === username)) {
          errorDiv.textContent = 'Username already taken';
          errorDiv.classList.add('show');
          return;
        }
        
        if (users.find(u => u.email === email)) {
          errorDiv.textContent = 'Email already registered';
          errorDiv.classList.add('show');
          return;
        }
        
        const newUser = {
          id: Utils.generateId(),
          username,
          email,
          password,
          displayName: displayName || username,
          bio: '',
          avatar: null,
          cover: null,
          isVerified: false,
          isAdmin: false,
          isDev: false,
          isOnline: true,
          status: 'online',
          createdAt: new Date().toISOString(),
          followers: [],
          following: [],
          posts: 0,
          banned: false,
          banReason: null
        };
        
        users.push(newUser);
        DB.saveUsers(users);
        
        currentUser = newUser;
        DB.saveCurrentUser(newUser);
        Utils.showToast('Account created successfully!', 'success');
        Router.navigate('/');
      },
      
      logout() {
        if (currentUser) {
          const users = DB.getUsers();
          const idx = users.findIndex(u => u.id === currentUser.id);
          if (idx !== -1) {
            users[idx].isOnline = false;
            users[idx].status = 'offline';
            DB.saveUsers(users);
          }
        }
        currentUser = null;
        DB.saveCurrentUser(null);
        Utils.showToast('Logged out successfully');
        Router.navigate('login');
      }
    };
    
    // Posts Module
    const Posts = {
      previewMedia(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        if (file.size > 5 * 1024 * 1024) {
          Utils.showToast('File too large. Max 5MB.', 'error');
          e.target.value = '';
          return;
        }
        
        currentMediaFile = file;
        const reader = new FileReader();
        reader.onload = (e) => {
          const preview = document.getElementById('media-preview');
          preview.innerHTML = `
            <div class="media-preview-container">
              ${file.type.startsWith('video/') 
                ? `<video src="${e.target.result}" controls></video>`
                : `<img src="${e.target.result}" alt="Preview">`
              }
              <button class="remove-media" onclick="Posts.clearMedia()">√ó</button>
            </div>
          `;
        };
        reader.readAsDataURL(file);
      },
      
      clearMedia() {
        currentMediaFile = null;
        document.getElementById('post-media').value = '';
        document.getElementById('media-preview').innerHTML = '';
      },
      
      create() {
        const content = document.getElementById('post-content').value;
        
        if (!content.trim() && !currentMediaFile) {
          Utils.showToast('Please write something or attach media', 'error');
          return;
        }
        
        const posts = DB.getPosts();
        const newPost = {
          id: Utils.generateId(),
          userId: currentUser.id,
          content: content,
          type: currentMediaFile ? (currentMediaFile.type.startsWith('video/') ? 'video' : 'image') : 'text',
          mediaUrl: null,
          likes: [],
          comments: [],
          shares: 0,
          createdAt: new Date().toISOString()
        };
        
        const savePost = () => {
          posts.unshift(newPost);
          DB.savePosts(posts);
          
          // Update user post count
          const users = DB.getUsers();
          const idx = users.findIndex(u => u.id === currentUser.id);
          users[idx].posts = (users[idx].posts || 0) + 1;
          DB.saveUsers(users);
          
          currentMediaFile = null;
          Utils.showToast('Post created!', 'success');
          Router.navigate('/');
        };
        
        if (currentMediaFile) {
          const reader = new FileReader();
          reader.onload = (e) => {
            newPost.mediaUrl = e.target.result;
            savePost();
          };
          reader.readAsDataURL(currentMediaFile);
        } else {
          savePost();
        }
      },
      
      like(postId) {
        const posts = DB.getPosts();
        const idx = posts.findIndex(p => p.id === postId);
        if (idx === -1) return;
        
        const isLiked = posts[idx].likes.includes(currentUser.id);
        if (isLiked) {
          posts[idx].likes = posts[idx].likes.filter(id => id !== currentUser.id);
        } else {
          posts[idx].likes.push(currentUser.id);
        }
        
        DB.savePosts(posts);
        Router.handle(); // Re-render
      },
      
      toggleComments(postId) {
        const el = document.getElementById(`comments-${postId}`);
        if (el) el.classList.toggle('show');
      },
      
      comment(postId) {
        const input = document.getElementById(`comment-input-${postId}`);
        const content = input.value.trim();
        if (!content) return;
        
        const posts = DB.getPosts();
        const idx = posts.findIndex(p => p.id === postId);
        if (idx === -1) return;
        
        posts[idx].comments.push({
          id: Utils.generateId(),
          userId: currentUser.id,
          content,
          createdAt: new Date().toISOString()
        });
        
        DB.savePosts(posts);
        Router.handle(); // Re-render to show comment
      },
      
      delete(postId) {
        if (!confirm('Delete this post? This cannot be undone.')) return;
        
        let posts = DB.getPosts();
        posts = posts.filter(p => p.id !== postId);
        DB.savePosts(posts);
        
        Utils.showToast('Post deleted');
        Router.handle();
      }
    };
    
    // Users Module
    const Users = {
      follow(userId) {
        const users = DB.getUsers();
        const currentIdx = users.findIndex(u => u.id === currentUser.id);
        const targetIdx = users.findIndex(u => u.id === userId);
        
        if (currentIdx === -1 || targetIdx === -1) return;
        
        const isFollowing = users[currentIdx].following.includes(userId);
        
        if (isFollowing) {
          users[currentIdx].following = users[currentIdx].following.filter(id => id !== userId);
          users[targetIdx].followers = users[targetIdx].followers.filter(id => id !== currentUser.id);
          Utils.showToast('Unfollowed user');
        } else {
          users[currentIdx].following.push(userId);
          users[targetIdx].followers.push(currentUser.id);
          Utils.showToast('Now following user');
        }
        
        DB.saveUsers(users);
        currentUser = users[currentIdx];
        DB.saveCurrentUser(currentUser);
        Router.handle();
      }
    };
    
    // Dev Module
    const Dev = {
      showCreateModal() {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.innerHTML = `
          <div class="modal">
            <div class="modal-header">
              <h2>Create Test User</h2>
              <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">√ó</button>
            </div>
            <form id="create-user-form">
              <div class="form-group">
                <label>Username</label>
                <input type="text" id="fake-username" required>
              </div>
              <div class="form-group">
                <label>Display Name</label>
                <input type="text" id="fake-display">
              </div>
              <div class="form-group">
                <label>Bio</label>
                <textarea id="fake-bio" rows="2"></textarea>
              </div>
              <div style="margin-bottom:16px;">
                <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                  <input type="checkbox" id="fake-verified" style="width:auto;">
                  <span>Verified Account</span>
                </label>
              </div>
              <div style="display:flex; gap:12px;">
                <button type="button" class="btn btn-outline" style="flex:1;" onclick="this.closest('.modal-overlay').remove()">Cancel</button>
                <button type="submit" class="btn" style="flex:1;">Create</button>
              </div>
            </form>
          </div>
        `;
        document.body.appendChild(modal);
        
        // Animation
        setTimeout(() => modal.classList.add('show'), 10);
        
        document.getElementById('create-user-form').addEventListener('submit', (e) => {
          e.preventDefault();
          this.createUser();
        });
      },
      
      createUser() {
        const username = document.getElementById('fake-username').value;
        const displayName = document.getElementById('fake-display').value || username;
        const bio = document.getElementById('fake-bio').value;
        const isVerified = document.getElementById('fake-verified').checked;
        
        const users = DB.getUsers();
        
        if (users.find(u => u.username === username)) {
          Utils.showToast('Username already exists', 'error');
          return;
        }
        
        const newUser = {
          id: Utils.generateId(),
          username,
          email: `${username}@test.netsphere.com`,
          password: 'password123',
          displayName,
          bio,
          avatar: null,
          cover: null,
          isVerified,
          isAdmin: false,
          isDev: false,
          isOnline: Math.random() > 0.5,
          status: 'offline',
          createdAt: new Date().toISOString(),
          followers: [],
          following: [],
          posts: 0,
          banned: false,
          banReason: null,
          isFake: true
        };
        
        users.push(newUser);
        DB.saveUsers(users);
        
        document.querySelector('.modal-overlay').remove();
        Utils.showToast('Test user created', 'success');
        Router.handle();
      },
      
      verify(userId, verify) {
        const users = DB.getUsers();
        const idx = users.findIndex(u => u.id === userId);
        if (idx === -1) return;
        
        users[idx].isVerified = verify;
        DB.saveUsers(users);
        Utils.showToast(verify ? 'User verified' : 'Verification removed');
        Router.handle();
      },
      
      ban(userId, ban) {
        const users = DB.getUsers();
        const idx = users.findIndex(u => u.id === userId);
        if (idx === -1) return;
        
        if (ban) {
          const reason = prompt('Enter ban reason:');
          if (!reason) return;
          users[idx].banned = true;
          users[idx].banReason = reason;
          Utils.showToast('User banned');
        } else {
          users[idx].banned = false;
          users[idx].banReason = null;
          Utils.showToast('User unbanned');
        }
        
        DB.saveUsers(users);
        Router.handle();
      },
      
      deleteUser(userId) {
        if (!confirm('Are you sure? This will delete the user and all their posts. This cannot be undone!')) return;
        
        let users = DB.getUsers();
        users = users.filter(u => u.id !== userId);
        DB.saveUsers(users);
        
        let posts = DB.getPosts();
        posts = posts.filter(p => p.userId !== userId);
        DB.savePosts(posts);
        
        Utils.showToast('User deleted');
        Router.handle();
      }
    };
    
    // Initialize App
    window.addEventListener('DOMContentLoaded', () => {
      Views.init();
    });
    
    // Handle browser back/forward buttons
    window.addEventListener('hashchange', () => {
      Router.handle();
    });
    
    // Make functions globally accessible for HTML onclick handlers
    window.Router = Router;
    window.Posts = Posts;
    window.Users = Users;
    window.Dev = Dev;
    window.Auth = Auth;
  </script>
</body>
</html>
