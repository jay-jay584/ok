<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NetSphere - Social Platform</title>
  <base href="./">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #0f0f13;
      --surface: #1a1a20;
      --surface-light: #252530;
      --accent: #00d4ff;
      --accent-secondary: #7000ff;
      --text: #ffffff;
      --text-sec: #a0a0b0;
      --danger: #ff3860;
      --warning: #ffdd57;
      --success: #23d160;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(0, 212, 255, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(112, 0, 255, 0.1) 0%, transparent 20%);
    }
    
    /* CRITICAL FIX: Error Messages */
    .error-msg {
      display: none;
      background: rgba(255, 56, 96, 0.2);
      color: var(--danger);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      border: 1px solid var(--danger);
      font-size: 0.9rem;
    }
    
    .error-msg.show {
      display: block;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      color: var(--text);
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    /* Animated Logo */
    .logo-container {
      position: relative;
      width: 50px;
      height: 50px;
      cursor: pointer;
    }
    
    .logo-sphere {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      animation: rotate 10s linear infinite;
    }
    
    @keyframes rotate {
      from { transform: rotateY(0deg) rotateX(10deg); }
      to { transform: rotateY(360deg) rotateX(10deg); }
    }
    
    .logo-ring {
      position: absolute;
      width: 100%;
      height: 100%;
      border: 3px solid var(--accent);
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.5), inset 0 0 20px rgba(0, 212, 255, 0.2);
    }
    
    .logo-ring:nth-child(1) { transform: rotateY(0deg); }
    .logo-ring:nth-child(2) { transform: rotateY(60deg); }
    .logo-ring:nth-child(3) { transform: rotateY(120deg); }
    
    .logo-n {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Poppins', sans-serif;
      font-weight: 800;
      font-size: 1.5rem;
      color: var(--text);
      text-shadow: 0 0 10px var(--accent);
      z-index: 10;
      pointer-events: none;
    }
    
    .logo-pulse {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 2px solid var(--accent);
      animation: pulse 2s ease-out infinite;
      opacity: 0;
    }
    
    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
      100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
    }
    
    /* Loading Screen */
    #loading {
      position: fixed;
      inset: 0;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      gap: 20px;
    }
    
    .loading-text {
      font-family: 'Poppins', sans-serif;
      font-size: 1.5rem;
      background: linear-gradient(90deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 2s linear infinite;
    }
    
    @keyframes shimmer {
      0% { opacity: 0.5; }
      50% { opacity: 1; }
      100% { opacity: 0.5; }
    }
    
    /* Navigation */
    .nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: rgba(15, 15, 19, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      z-index: 100;
      padding: 0 20px;
    }
    
    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 70px;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      position: relative;
    }
    
    .brand-text {
      font-family: 'Poppins', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .click-hint {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.7rem;
      color: var(--accent);
      opacity: 0;
      transition: opacity 0.3s;
      white-space: nowrap;
      background: rgba(0,0,0,0.8);
      padding: 4px 8px;
      border-radius: 4px;
      pointer-events: none;
    }
    
    .click-hint.show { opacity: 1; }
    
    .nav-links {
      display: flex;
      gap: 8px;
    }
    
    .nav-link {
      padding: 10px 20px;
      border-radius: 20px;
      color: var(--text-sec);
      font-weight: 500;
      transition: all 0.3s;
      cursor: pointer;
      border: none;
      background: transparent;
      font-family: inherit;
      font-size: 0.95rem;
      position: relative;
      overflow: hidden;
    }
    
    .nav-link:hover {
      color: var(--text);
      background: rgba(255,255,255,0.05);
    }
    
    .nav-link.dev {
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      font-weight: 600;
    }
    
    /* Main Layout */
    .main {
      padding-top: 90px;
      max-width: 600px;
      margin: 0 auto;
      padding-bottom: 40px;
      padding-left: 20px;
      padding-right: 20px;
    }
    
    .main.wide { max-width: 1200px; }
    
    /* Cards */
    .card {
      background: var(--surface);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid rgba(255,255,255,0.05);
      animation: fadeIn 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Buttons */
    .btn {
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: inherit;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      position: relative;
      overflow: hidden;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid rgba(255,255,255,0.1);
      color: var(--text);
    }
    
    .btn-outline:hover {
      border-color: var(--accent);
      background: rgba(0, 212, 255, 0.1);
    }
    
    .btn-danger {
      background: var(--danger);
    }
    
    .btn-warning {
      background: var(--warning);
      color: var(--bg);
    }
    
    .btn-small {
      padding: 6px 12px;
      font-size: 0.875rem;
    }
    
    /* Forms */
    input, textarea, select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      font-size: 1rem;
      font-family: inherit;
      outline: none;
      transition: all 0.3s;
      background: var(--surface-light);
      color: var(--text);
    }
    
    input:focus, textarea:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
    }
    
    /* Auth Pages */
    .auth-page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }
    
    .auth-bg {
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(circle at 20% 50%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 50%, rgba(112, 0, 255, 0.1) 0%, transparent 50%);
      animation: bgRotate 20s linear infinite;
    }
    
    @keyframes bgRotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .auth-card {
      background: var(--surface);
      border-radius: 32px;
      padding: 40px;
      width: 100%;
      max-width: 420px;
      border: 1px solid rgba(255,255,255,0.1);
      position: relative;
      z-index: 1;
      backdrop-filter: blur(20px);
    }
    
    /* Dev Hint */
    .dev-reveal {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(112, 0, 255, 0.1));
      border: 1px solid rgba(0, 212, 255, 0.3);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      display: none;
      animation: slideDown 0.3s ease;
    }
    
    .dev-reveal.show { display: block; }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Avatar with Upload */
    .avatar-container {
      position: relative;
      display: inline-block;
    }
    
    .avatar {
      width: 48px; height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
      flex-shrink: 0;
      border: 2px solid rgba(255,255,255,0.1);
      overflow: hidden;
      position: relative;
    }
    
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .avatar.large {
      width: 120px;
      height: 120px;
      font-size: 3rem;
    }
    
    .avatar-upload {
      position: absolute;
      bottom: 0;
      right: 0;
      background: var(--accent);
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 3px solid var(--surface);
      font-size: 0.875rem;
    }
    
    /* Profile Header */
    .profile-header {
      position: relative;
    }
    
    .cover-image {
      height: 200px;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      border-radius: 20px 20px 0 0;
      position: relative;
      overflow: hidden;
    }
    
    .cover-image::after {
      content: '';
      position: absolute;
      inset: 0;
      background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg "><rect width="100" height="100" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></svg>');
      opacity: 0.3;
    }
    
    .profile-info {
      padding: 0 24px 24px;
      position: relative;
    }
    
    .profile-avatar-wrapper {
      margin-top: -60px;
      position: relative;
      display: inline-block;
    }
    
    /* Posts */
    .post-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .post-meta h4 {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .post-meta span {
      color: var(--text-sec);
      font-size: 0.875rem;
    }
    
    .verified, .admin-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px; height: 16px;
      border-radius: 50%;
      font-size: 10px;
    }
    
    .verified { background: var(--accent); color: black; }
    .admin-badge { background: var(--danger); color: white; }
    
    .post-content {
      margin-bottom: 16px;
      line-height: 1.6;
      white-space: pre-wrap;
    }
    
    .post-media {
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 16px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .post-media img, .post-media video {
      width: 100%;
      display: block;
    }
    
    .post-actions {
      display: flex;
      gap: 20px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.05);
    }
    
    .post-action {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--text-sec);
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }
    
    .post-action:hover { color: var(--accent); }
    .post-action.liked { color: var(--danger); }
    
    /* Dev Panel */
    .dev-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }
    
    .dev-card {
      background: var(--surface);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 20px;
    }
    
    .dev-card h3 {
      margin-bottom: 16px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
      font-family: 'Poppins', sans-serif;
    }
    
    .log-container {
      background: var(--bg);
      border-radius: 12px;
      padding: 16px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      display: flex;
      gap: 8px;
    }
    
    .log-time { color: var(--text-sec); font-size: 0.75rem; }
    .log-type { color: var(--accent); font-weight: bold; }
    .log-msg { color: var(--text); }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      backdrop-filter: blur(10px);
    }
    
    .modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }
    
    .modal {
      background: var(--surface);
      border-radius: 24px;
      padding: 24px;
      width: 100%;
      max-width: 500px;
      border: 1px solid rgba(255,255,255,0.1);
      transform: scale(0.9);
      transition: transform 0.3s;
    }
    
    .modal-overlay.show .modal {
      transform: scale(1);
    }
    
    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 300;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .toast {
      background: var(--surface);
      color: var(--text);
      padding: 16px 24px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      animation: slideIn 0.3s ease;
      max-width: 400px;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 12px;
      backdrop-filter: blur(20px);
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    
    .toast.error { border-left: 4px solid var(--danger); }
    .toast.success { border-left: 4px solid var(--success); }
    .toast.warning { border-left: 4px solid var(--warning); }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    /* Secret Input */
    .secret-input {
      letter-spacing: 0.5em;
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      background: var(--bg);
      border: 2px solid rgba(0, 212, 255, 0.3);
    }
    
    /* Impersonation Banner */
    .impersonation-banner {
      background: linear-gradient(90deg, rgba(255, 221, 87, 0.2), rgba(255, 221, 87, 0.05));
      border: 1px solid var(--warning);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: between;
      gap: 16px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .nav-links { display: none; }
      .dev-grid { grid-template-columns: 1fr; }
    }
    
    /* Utility */
    .hidden { display: none !important; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .gap-2 { gap: 8px; }
    .mt-2 { margin-top: 8px; }
    .mt-4 { margin-top: 16px; }
    .w-full { width: 100%; }
    
    /* Badges */
    .badge {
      display: inline-flex;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 4px;
    }
    
    .badge-dev { background: var(--accent); color: black; }
    .badge-permanent { background: var(--danger); color: white; }
    .badge-shadow { background: #333; color: #999; }
    
    /* Settings Modal */
    .settings-section {
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .settings-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
  </style>
<base target="_blank">
<base target="_blank">
</head>
<body>
  <div id="loading">
    <div class="logo-container" style="width: 80px; height: 80px;">
      <div class="logo-sphere">
        <div class="logo-ring"></div>
        <div class="logo-ring"></div>
        <div class="logo-ring"></div>
        <div class="logo-pulse"></div>
      </div>
      <div class="logo-n">N</div>
    </div>
    <div class="loading-text">NetSphere</div>
  </div>
  
  <div id="app" style="display:none;"></div>
  <div class="toast-container" id="toast-container"></div>

  <script>
    'use strict';
    
    // Configuration
    const SECRET_CODE = '020212';
    const LOGO_CLICKS_REQUIRED = 20;
    let logoClickCount = 0;
    let devHintUnlocked = localStorage.getItem('ns_dev_unlocked') === 'true';
    
    // System Logs (Dev Feature)
    const SystemLog = {
      logs: JSON.parse(localStorage.getItem('ns_logs') || '[]'),
      
      add(type, message, data = {}) {
        const entry = {
          id: Date.now(),
          time: new Date().toISOString(),
          type,
          message,
          data,
          user: currentUser?.username || 'anonymous'
        };
        this.logs.unshift(entry);
        if (this.logs.length > 100) this.logs.pop(); // Keep last 100
        localStorage.setItem('ns_logs', JSON.stringify(this.logs));
      },
      
      getLogs(filter = null) {
        if (filter) return this.logs.filter(l => l.type === filter);
        return this.logs;
      },
      
      clear() {
        this.logs = [];
        localStorage.setItem('ns_logs', JSON.stringify(this.logs));
      },
      
      export() {
        return JSON.stringify(this.logs, null, 2);
      }
    };
    
    // Database
    const DB = {
      KEYS: {
        USERS: 'ns_users_v3',
        POSTS: 'ns_posts_v3',
        CURRENT_USER: 'ns_current_v3'
      },
      
      getUsers() {
        try { return JSON.parse(localStorage.getItem(this.KEYS.USERS)) || []; }
        catch(e) { return []; }
      },
      
      getPosts() {
        try { return JSON.parse(localStorage.getItem(this.KEYS.POSTS)) || []; }
        catch(e) { return []; }
      },
      
      getCurrentUser() {
        try { return JSON.parse(localStorage.getItem(this.KEYS.CURRENT_USER)); }
        catch(e) { return null; }
      },
      
      saveUsers(users) {
        localStorage.setItem(this.KEYS.USERS, JSON.stringify(users));
      },
      
      savePosts(posts) {
        localStorage.setItem(this.KEYS.POSTS, JSON.stringify(posts));
      },
      
      saveCurrentUser(user) {
        localStorage.setItem(this.KEYS.CURRENT_USER, JSON.stringify(user));
      },
      
      init() {
        const users = this.getUsers();
        if (!users.find(u => u.username === 'jayjay')) {
          users.push({
            id: 'dev-' + Date.now(),
            username: 'jayjay',
            email: 'dev@netsphere.com',
            password: '2012!',
            displayName: 'JayJay',
            bio: 'System Administrator üë®‚Äçüíª | NetSphere Creator',
            avatar: null,
            cover: null,
            isVerified: true,
            isAdmin: true,
            isDev: true,
            isOnline: true,
            status: 'online',
            createdAt: new Date().toISOString(),
            followers: [],
            following: [],
            posts: 0,
            banned: false,
            shadowBanned: false,
            banReason: null,
            lastIP: null,
            metadata: {}
          });
          this.saveUsers(users);
          SystemLog.add('SYSTEM', 'Dev account initialized');
        }
      },
      
      exportAll() {
        return {
          users: this.getUsers(),
          posts: this.getPosts(),
          logs: SystemLog.logs,
          exportedAt: new Date().toISOString()
        };
      },
      
      importAll(data) {
        try {
          if (data.users) this.saveUsers(data.users);
          if (data.posts) this.savePosts(data.posts);
          if (data.logs) {
            SystemLog.logs = data.logs;
            localStorage.setItem('ns_logs', JSON.stringify(data.logs));
          }
          return true;
        } catch(e) {
          return false;
        }
      }
    };
    
    DB.init();
    
    // State
    let currentUser = DB.getCurrentUser();
    let currentMediaFile = null;
    let impersonatingUser = null;
    
    // Utils
    const Utils = {
      generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
      },
      
      formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);
        
        if (minutes < 1) return 'Just now';
        if (minutes < 60) return `${minutes}m ago`;
        if (hours < 24) return `${hours}h ago`;
        if (days < 7) return `${days}d ago`;
        return date.toLocaleDateString();
      },
      
      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      },
      
      showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        let icon = '‚ÑπÔ∏è';
        if (type === 'error') icon = '‚ùå';
        if (type === 'success') icon = '‚úÖ';
        if (type === 'warning') icon = '‚ö†Ô∏è';
        
        toast.innerHTML = `<span>${icon}</span><span>${message}</span>`;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      },
      
      formatBytes(bytes, decimals = 2) {
        if (!bytes) return '0 Bytes';
        const k = 1024;
        const dm = decimals < 0 ? 0 : decimals;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
      }
    };
    
    // Router
    const Router = {
      navigate(path) {
        window.location.hash = path;
      },
      
      handle() {
        const hash = window.location.hash.slice(1) || '/';
        const [route, ...params] = hash.split('/');
        
        if (!currentUser && route !== 'login' && route !== 'register') {
          this.navigate('login');
          return;
        }
        
        if (currentUser && (route === 'login' || route === 'register')) {
          this.navigate('/');
          return;
        }
        
        // Track page views
        if (currentUser) {
          SystemLog.add('NAVIGATE', `Viewed ${route || 'home'}`, { route, params });
        }
        
        switch(route) {
          case 'login':
            Views.showLogin();
            break;
          case 'register':
            Views.showRegister();
            break;
          case 'profile':
            Views.showProfile(params[0] || currentUser.username);
            break;
          case 'dev':
            if (currentUser?.isDev) Views.showDevPanel();
            else this.navigate('/');
            break;
          case 'settings':
            Views.showSettings();
            break;
          default:
            Views.showHome();
        }
      }
    };
    
    // Global Logo Handler
    window.handleLogoClick = function() {
      logoClickCount++;
      console.log(`Logo clicks: ${logoClickCount}/${LOGO_CLICKS_REQUIRED}`);
      
      const hint = document.getElementById('click-hint');
      if (hint) {
        hint.textContent = `${LOGO_CLICKS_REQUIRED - logoClickCount} clicks to unlock...`;
        hint.classList.add('show');
        setTimeout(() => hint && hint.classList.remove('show'), 1500);
      }
      
      if (logoClickCount >= LOGO_CLICKS_REQUIRED) {
        logoClickCount = 0;
        Views.showSecretModal();
      }
    };
    
    // Secret Code Check
    window.checkSecretCode = function() {
      const input = document.getElementById('secret-code').value;
      if (input === SECRET_CODE) {
        devHintUnlocked = true;
        localStorage.setItem('ns_dev_unlocked', 'true');
        document.querySelector('.modal-overlay').remove();
        Utils.showToast('üîì Developer access granted!', 'success');
        SystemLog.add('SECURITY', 'Dev access unlocked via secret code');
        Router.handle();
      } else {
        const error = document.getElementById('code-error');
        if (error) {
          error.style.display = 'block';
          error.textContent = '‚ùå Invalid code';
        }
        document.getElementById('secret-code').value = '';
        SystemLog.add('SECURITY', 'Failed dev access attempt');
      }
    };
    
    // Views
    const Views = {
      init() {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        
        if (currentUser) {
          const users = DB.getUsers();
          const idx = users.findIndex(u => u.id === currentUser.id);
          if (idx !== -1) {
            users[idx].isOnline = true;
            users[idx].lastActive = new Date().toISOString();
            // Simulate IP logging
            users[idx].lastIP = '192.168.x.' + Math.floor(Math.random() * 255);
            DB.saveUsers(users);
            currentUser = users[idx];
            DB.saveCurrentUser(currentUser);
          }
          SystemLog.add('AUTH', 'User logged in', { username: currentUser.username });
          Router.handle();
        } else {
          Router.navigate('login');
        }
      },
      
      renderLogo() {
        return `
          <div class="logo-container" onclick="handleLogoClick()">
            <div class="logo-sphere">
              <div class="logo-ring"></div>
              <div class="logo-ring"></div>
              <div class="logo-ring"></div>
              <div class="logo-pulse"></div>
            </div>
            <div class="logo-n">N</div>
            <span class="click-hint" id="click-hint">20 clicks to unlock...</span>
          </div>
        `;
      },
      
      renderNav() {
        const isDev = currentUser?.isDev;
        return `
          <nav class="nav">
            <div class="nav-inner">
              <div class="brand">
                ${this.renderLogo()}
                <span class="brand-text">NetSphere</span>
              </div>
              <div class="nav-links">
                <button class="nav-link" onclick="Router.navigate('/')">üè† Home</button>
                <button class="nav-link" onclick="Router.navigate('profile/${currentUser.username}')">üë§ Profile</button>
                <button class="nav-link" onclick="Router.navigate('settings')">‚öôÔ∏è Settings</button>
                ${isDev ? `<button class="nav-link dev" onclick="Router.navigate('dev')">üõ°Ô∏è Dev</button>` : ''}
                <button class="nav-link" onclick="Auth.logout()">üö™ Logout</button>
              </div>
            </div>
          </nav>
        `;
      },
      
      showSecretModal() {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay show';
        modal.innerHTML = `
          <div class="modal">
            <div class="modal-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
              <h2 style="color:var(--accent);">üîí Developer Access</h2>
              <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="background:none; border:none; color:var(--text-sec); font-size:1.5rem; cursor:pointer;">√ó</button>
            </div>
            <p style="margin-bottom:20px; color:var(--text-sec);">Enter the secret code to unlock developer features.</p>
            <div id="code-error" style="display:none; background:rgba(255,56,96,0.2); color:var(--danger); padding:12px; border-radius:8px; margin-bottom:16px; border:1px solid var(--danger);"></div>
            <input type="password" id="secret-code" class="secret-input" placeholder="000000" maxlength="6">
            <button class="btn w-full mt-4" onclick="checkSecretCode()">Unlock Access</button>
          </div>
        `;
        document.body.appendChild(modal);
        document.getElementById('secret-code').focus();
      },
      
      showLogin() {
        document.getElementById('app').innerHTML = `
          <div class="auth-page">
            <div class="auth-bg"></div>
            <div class="auth-card">
              <div style="text-align:center; margin-bottom:30px;">
                <div style="display:inline-block; margin-bottom:16px;">
                  ${this.renderLogo()}
                </div>
                <h1 style="font-family: Poppins; font-size:2rem; margin-bottom:8px;">NetSphere</h1>
                <p style="color:var(--text-sec);">Your World, One Scroll</p>
              </div>
              
              <div class="dev-reveal ${devHintUnlocked ? 'show' : ''}">
                <strong style="color:var(--accent);">üë®‚Äçüíª Developer Access Granted</strong><br>
                <div style="margin-top:8px; font-size:0.9rem;">
                  Username: <code style="background:rgba(0,0,0,0.3); padding:2px 6px; border-radius:4px;">jayjay</code><br>
                  Password: <code style="background:rgba(0,0,0,0.3); padding:2px 6px; border-radius:4px;">2012!</code>
                </div>
                <button class="btn w-full mt-2" onclick="document.getElementById('login-username').value='jayjay';document.getElementById('login-password').value='2012!'">Auto-fill Credentials</button>
              </div>
              
              <div id="login-error" class="error-msg"></div>
              
              <form id="login-form">
                <div class="form-group">
                  <label>Username or Email</label>
                  <input type="text" id="login-username" required autofocus placeholder="Enter username">
                </div>
                <div class="form-group">
                  <label>Password</label>
                  <input type="password" id="login-password" required placeholder="Enter password">
                </div>
                <button type="submit" class="btn w-full">Log In</button>
              </form>
              
              <p style="text-align:center; margin-top:20px; color:var(--text-sec);">
                Don't have an account? 
                <a href="#register" style="color:var(--accent); text-decoration:none; font-weight:600;">Sign up</a>
              </p>
              
              ${!devHintUnlocked ? '<p style="text-align:center; margin-top:12px; font-size:0.75rem; color:var(--text-sec); opacity:0.6;">üí° Hint: The logo holds secrets...</p>' : ''}
            </div>
          </div>
        `;
        
        document.getElementById('login-form').addEventListener('submit', Auth.handleLogin);
      },
      
      showRegister() {
        document.getElementById('app').innerHTML = `
          <div class="auth-page">
            <div class="auth-bg"></div>
            <div class="auth-card">
              <div style="text-align:center; margin-bottom:30px;">
                <h1 style="font-family: Poppins; font-size:2rem;">Create Account</h1>
                <p style="color:var(--text-sec);">Join the network</p>
              </div>
              
              <div id="register-error" class="error-msg"></div>
              
              <form id="register-form">
                <div class="form-group">
                  <label>Username *</label>
                  <input type="text" id="reg-username" required pattern="[a-zA-Z0-9_]+" placeholder="Choose username">
                </div>
                <div class="form-group">
                  <label>Email *</label>
                  <input type="email" id="reg-email" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                  <label>Display Name</label>
                  <input type="text" id="reg-display" placeholder="Your name">
                </div>
                <div class="form-group">
                  <label>Password *</label>
                  <input type="password" id="reg-password" required minlength="6" placeholder="Min 6 characters">
                </div>
                <div class="form-group">
                  <label>Confirm Password *</label>
                  <input type="password" id="reg-confirm" required placeholder="Confirm password">
                </div>
                <button type="submit" class="btn w-full">Create Account</button>
              </form>
              
              <p style="text-align:center; margin-top:20px; color:var(--text-sec);">
                Already have an account? 
                <a href="#login" style="color:var(--accent); text-decoration:none; font-weight:600;">Log in</a>
              </p>
            </div>
          </div>
        `;
        
        document.getElementById('register-form').addEventListener('submit', Auth.handleRegister);
      },
      
      showSettings() {
        document.getElementById('app').innerHTML = `
          ${this.renderNav()}
          <main class="main">
            <div class="card">
              <h2 style="margin-bottom:20px;">‚öôÔ∏è Settings</h2>
              
              <div class="settings-section">
                <h3 style="margin-bottom:16px; color:var(--accent);">Profile Picture</h3>
                <div style="display:flex; align-items:center; gap:20px; margin-bottom:16px;">
                  <div class="avatar-container">
                    <div class="avatar large" id="settings-avatar">
                      ${currentUser.avatar ? `<img src="${currentUser.avatar}">` : currentUser.displayName[0].toUpperCase()}
                    </div>
                    <label class="avatar-upload" style="cursor:pointer;">
                      üì∑
                      <input type="file" accept="image/*" style="display:none;" onchange="Users.updateAvatar(event)">
                    </label>
                  </div>
                  <div>
                    <p style="color:var(--text-sec); font-size:0.875rem;">Click the camera icon to upload a new profile picture</p>
                    <button class="btn btn-small btn-outline mt-2" onclick="Users.removeAvatar()" ${!currentUser.avatar ? 'disabled' : ''}>Remove Photo</button>
                  </div>
                </div>
              </div>
              
              <div class="settings-section">
                <h3 style="margin-bottom:16px; color:var(--accent);">Profile Information</h3>
                <form id="settings-form">
                  <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" id="settings-name" value="${currentUser.displayName}">
                  </div>
                  <div class="form-group">
                    <label>Bio</label>
                    <textarea id="settings-bio" rows="3" placeholder="Tell us about yourself...">${currentUser.bio || ''}</textarea>
                  </div>
                  <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="settings-email" value="${currentUser.email}">
                  </div>
                  <button type="submit" class="btn">Save Changes</button>
                </form>
              </div>
              
              <div class="settings-section">
                <h3 style="margin-bottom:16px; color:var(--danger);">Danger Zone</h3>
                <button class="btn btn-danger btn-outline" onclick="Users.deleteAccount()">Delete Account</button>
              </div>
            </div>
          </main>
        `;
        
        document.getElementById('settings-form').addEventListener('submit', Users.saveSettings);
      },
      
      showHome() {
        const posts = DB.getPosts().sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        
        const impersonateBanner = impersonatingUser ? `
          <div class="impersonation-banner">
            <div>
              <strong style="color:var(--warning);">üëª Impersonation Mode Active</strong>
              <p style="font-size:0.875rem; margin-top:4px; color:var(--text-sec);">Posting as <strong>${impersonatingUser.displayName}</strong> (@${impersonatingUser.username})</p>
            </div>
            <button class="btn btn-small btn-danger" onclick="Dev.stopImpersonating()">Stop</button>
          </div>
        ` : '';
        
        document.getElementById('app').innerHTML = `
          ${this.renderNav()}
          <main class="main">
            <div class="card">
              <div style="display:flex; align-items:center; gap:16px;">
                <div class="avatar" style="width:60px; height:60px; font-size:1.5rem;">
                  ${currentUser.avatar ? `<img src="${currentUser.avatar}" style="width:100%; height:100%; object-fit:cover;">` : currentUser.displayName[0].toUpperCase()}
                </div>
                <div style="flex:1;">
                  <h2 style="font-size:1.25rem;">Welcome back, ${currentUser.displayName}!</h2>
                  ${currentUser.isDev ? '<span style="color:var(--accent); font-size:0.875rem; font-weight:600;">üõ°Ô∏è Developer Mode</span>' : ''}
                  ${currentUser.shadowBanned ? '<span style="color:var(--danger); font-size:0.875rem;">üîá Shadow Banned</span>' : ''}
                </div>
              </div>
            </div>
            
            ${impersonateBanner}
            
            <div class="card">
              <div class="create-post" style="display:flex; gap:12px;">
                <div class="avatar" style="flex-shrink:0;">
                  ${impersonatingUser 
                    ? (impersonatingUser.avatar ? `<img src="${impersonatingUser.avatar}" style="width:100%; height:100%; object-fit:cover;">` : impersonatingUser.displayName[0].toUpperCase())
                    : (currentUser.avatar ? `<img src="${currentUser.avatar}" style="width:100%; height:100%; object-fit:cover;">` : currentUser.displayName[0].toUpperCase())
                  }
                </div>
                <div style="flex:1;">
                  <textarea id="post-content" placeholder="${impersonatingUser ? `Posting as ${impersonatingUser.displayName}...` : 'What\'s on your mind?'}" style="background:transparent; border:none; color:var(--text); width:100%; min-height:80px; resize:vertical; font-family:inherit;"></textarea>
                  <div class="create-post-actions" style="border-top:1px solid rgba(255,255,255,0.1); padding-top:12px; margin-top:12px; display:flex; justify-content:space-between; align-items:center;">
                    <label class="media-btn" style="cursor:pointer; color:var(--accent); font-size:0.9rem;">
                      üì∑ Media
                      <input type="file" id="post-media" accept="image/*,video/*" style="display:none;" onchange="Posts.previewMedia(event)">
                    </label>
                    <button class="btn" onclick="Posts.create()">Post</button>
                  </div>
                  <div id="media-preview"></div>
                </div>
              </div>
            </div>
            
            <div id="posts-container">
              ${posts.length === 0 
                ? '<div class="card empty-state" style="text-align:center; padding:40px;"><div style="font-size:3rem; margin-bottom:16px;">üåå</div><p style="color:var(--text-sec);">No posts yet. Start the conversation!</p></div>'
                : posts.map(post => this.renderPost(post)).join('')
              }
            </div>
          </main>
        `;
      },
      
      renderPost(post) {
        const users = DB.getUsers();
        const author = users.find(u => u.id === post.userId) || {};
        const isLiked = post.likes.includes(currentUser?.id);
        const isPermanent = post.permanent;
        const isImpersonated = post.isDevImpersonated;
        const canDelete = currentUser?.isDev || (!isPermanent && post.userId === currentUser?.id);
        const canEdit = currentUser?.isDev || post.userId === currentUser?.id;
        
        // Shadow ban check - if user is shadow banned, they see their own posts but others don't (except dev)
        if (author.shadowBanned && post.userId !== currentUser?.id && !currentUser?.isDev) {
          return '';
        }
        
        return `
          <div class="card" data-post-id="${post.id}">
            <div class="post-header">
              <div class="avatar" onclick="Router.navigate('profile/${author.username}')" style="cursor:pointer;">
                ${author.avatar 
                  ? `<img src="${author.avatar}" style="width:100%; height:100%; object-fit:cover;">`
                  : (author.displayName?.[0]?.toUpperCase() || 'U')
                }
              </div>
              <div class="post-meta">
                <h4 onclick="Router.navigate('profile/${author.username}')" style="cursor:pointer; color:var(--text);">
                  ${author.displayName || 'Unknown'}
                  ${author.isVerified ? '<span class="verified">‚úì</span>' : ''}
                  ${author.isDev ? '<span class="admin-badge">‚òÖ</span>' : ''}
                  ${isImpersonated ? '<span class="badge badge-dev">üë®‚Äçüíª DEV</span>' : ''}
                  ${isPermanent ? '<span class="badge badge-permanent">üîí PERMANENT</span>' : ''}
                </h4>
                <span>@${author.username || 'unknown'} ¬∑ ${Utils.formatDate(post.createdAt)}</span>
              </div>
            </div>
            
            <div class="post-content">${Utils.escapeHtml(post.content)}</div>
            
            ${post.mediaUrl ? `
              <div class="post-media">
                ${post.type === 'video' 
                  ? `<video src="${post.mediaUrl}" controls style="max-height:500px;"></video>`
                  : `<img src="${post.mediaUrl}" style="max-height:500px; width:100%; object-fit:cover;">`
                }
              </div>
            ` : ''}
            
            <div class="post-actions">
              <div class="post-action ${isLiked ? 'liked' : ''}" onclick="Posts.like('${post.id}')">
                <span>${isLiked ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                <span>${post.likes.length}</span>
              </div>
              <div class="post-action" onclick="Posts.toggleComments('${post.id}')">
                <span>üí¨</span>
                <span>${post.comments.length}</span>
              </div>
              ${canEdit ? `
                <div class="post-action" onclick="Posts.edit('${post.id}')" style="margin-left:auto;">
                  <span>‚úèÔ∏è</span>
                </div>
              ` : ''}
              ${canDelete ? `
                <div class="post-action delete" onclick="Posts.delete('${post.id}')" style="color:var(--danger);">
                  <span>üóëÔ∏è</span>
                </div>
              ` : ''}
            </div>
            
            <div class="comments-section" id="comments-${post.id}" style="display:none; margin-top:16px; padding-top:16px; border-top:1px solid rgba(255,255,255,0.1);">
              ${post.comments.map(c => {
                const commenter = users.find(u => u.id === c.userId) || {};
                // Hide shadow banned comments from non-devs
                if (commenter.shadowBanned && c.userId !== currentUser?.id && !currentUser?.isDev) return '';
                return `
                  <div class="comment" style="display:flex; gap:12px; margin-bottom:12px;">
                    <div class="avatar small" style="width:32px; height:32px; font-size:0.9rem;">
                      ${commenter.avatar ? `<img src="${commenter.avatar}" style="width:100%; height:100%; object-fit:cover;">` : (commenter.displayName?.[0]?.toUpperCase() || 'U')}
                    </div>
                    <div style="background:var(--surface-light); padding:8px 12px; border-radius:12px; flex:1;">
                      <div style="font-weight:600; font-size:0.875rem; display:flex; align-items:center; gap:4px;">
                        ${commenter.displayName || 'Unknown'}
                        ${commenter.shadowBanned ? '<span class="badge badge-shadow">shadow</span>' : ''}
                      </div>
                      <p style="margin:0; font-size:0.875rem;">${Utils.escapeHtml(c.content)}</p>
                    </div>
                  </div>
                `;
              }).join('')}
              <div style="display:flex; gap:12px; margin-top:12px;">
                <div class="avatar small" style="width:32px; height:32px; font-size:0.9rem;">
                  ${currentUser.avatar ? `<img src="${currentUser.avatar}" style="width:100%; height:100%; object-fit:cover;">` : currentUser.displayName[0].toUpperCase()}
                </div>
                <input type="text" id="comment-input-${post.id}" placeholder="Write a comment..." style="flex:1;" onkeypress="if(event.key==='Enter') Posts.comment('${post.id}')">
                <button class="btn btn-small" onclick="Posts.comment('${post.id}')">Post</button>
              </div>
            </div>
          </div>
        `;
      },
      
      showProfile(username) {
        const users = DB.getUsers();
        const profile = users.find(u => u.username === username);
        if (!profile) {
          Utils.showToast('User not found', 'error');
          Router.navigate('/');
          return;
        }
        
        const posts = DB.getPosts()
          .filter(p => p.userId === profile.id)
          .filter(p => !profile.shadowBanned || currentUser?.isDev || p.userId === currentUser?.id)
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        
        if (profile.shadowBanned && profile.id !== currentUser?.id && !currentUser?.isDev) {
          Utils.showToast('User not found', 'error');
          Router.navigate('/');
          return;
        }
        
        const isFollowing = profile.followers.includes(currentUser?.id);
        const isOwn = currentUser?.id === profile.id;
        
        const impersonateBtn = (currentUser?.isDev && !profile.isDev) ? `
          <button class="btn btn-small btn-warning" onclick="Dev.impersonate('${profile.id}')" style="margin-left:8px;">
            üëª Impersonate
          </button>
        ` : '';
        
        document.getElementById('app').innerHTML = `
          ${this.renderNav()}
          <main class="main" style="max-width:800px;">
            <div class="card profile-header" style="padding:0; border:none;">
              <div class="cover-image"></div>
              <div class="profile-info">
                <div class="profile-avatar-wrapper">
                  <div class="avatar large">
                    ${profile.avatar 
                      ? `<img src="${profile.avatar}" style="width:100%; height:100%; object-fit:cover;">`
                      : profile.displayName[0].toUpperCase()
                    }
                  </div>
                  ${currentUser?.isDev && profile.shadowBanned ? '<div style="position:absolute; bottom:0; right:-10px; background:var(--danger); color:white; padding:4px 8px; border-radius:8px; font-size:0.75rem; font-weight:bold;">SHADOW BANNED</div>' : ''}
                </div>
                <div class="profile-name" style="margin-top:16px;">
                  <h1 style="display:inline; margin-right:8px;">${profile.displayName}</h1>
                  ${profile.isVerified ? '<span class="verified" style="width:22px; height:22px; font-size:12px;">‚úì</span>' : ''}
                  ${profile.isDev ? '<span style="background:var(--accent); color:black; padding:2px 8px; border-radius:6px; font-size:0.75rem; font-weight:bold;">DEV</span>' : ''}
                </div>
                <p style="color:var(--text-sec);">@${profile.username}</p>
                ${profile.bio ? `<p style="margin-top:12px; color:var(--text);">${Utils.escapeHtml(profile.bio)}</p>` : ''}
                ${profile.shadowBanned ? '<p style="color:var(--danger); font-size:0.875rem; margin-top:8px;">üîá Account restricted</p>' : ''}
                
                <div class="profile-stats" style="display:flex; gap:24px; margin-top:16px; border-top:1px solid rgba(255,255,255,0.1); padding-top:16px;">
                  <div>
                    <strong>${posts.length}</strong>
                    <span style="color:var(--text-sec); display:block; font-size:0.875rem;">Posts</span>
                  </div>
                  <div>
                    <strong>${profile.followers.length}</strong>
                    <span style="color:var(--text-sec); display:block; font-size:0.875rem;">Followers</span>
                  </div>
                  <div>
                    <strong>${profile.following.length}</strong>
                    <span style="color:var(--text-sec); display:block; font-size:0.875rem;">Following</span>
                  </div>
                </div>
                
                <div style="margin-top:20px; display:flex; gap:8px;">
                  ${!isOwn ? `
                    <button class="btn ${isFollowing ? 'btn-outline' : ''}" onclick="Users.follow('${profile.id}')">
                      ${isFollowing ? 'Following' : 'Follow'}
                    </button>
                  ` : `
                    <button class="btn btn-outline" onclick="Router.navigate('settings')">Edit Profile</button>
                  `}
                  ${impersonateBtn}
                </div>
              </div>
            </div>
            
            <h3 style="margin:24px 0 16px;">Posts</h3>
            ${posts.length === 0 ? '<div class="card" style="text-align:center; padding:40px; color:var(--text-sec);"><p>No posts yet</p></div>' : posts.map(post => this.renderPost(post)).join('')}
          </main>
        `;
      },
      
      showDevPanel() {
        const users = DB.getUsers();
        const posts = DB.getPosts();
        const logs = SystemLog.getLogs();
        
        const storageUsed = new Blob([JSON.stringify(localStorage)]).size;
        
        const stats = {
          totalUsers: users.length,
          totalPosts: posts.length,
          onlineUsers: users.filter(u => u.isOnline).length,
          permanentPosts: posts.filter(p => p.permanent).length,
          shadowBanned: users.filter(u => u.shadowBanned).length
        };
        
        const userOptions = users.filter(u => !u.isDev).map(u => 
          `<option value="${u.id}">${u.displayName} (@${u.username}) ${u.shadowBanned ? '[SHADOW BANNED]' : ''}</option>`
        ).join('');
        
        const recentLogs = logs.slice(0, 20).map(log => {
          const time = new Date(log.time).toLocaleTimeString();
          return `
            <div class="log-entry">
              <span class="log-time">${time}</span>
              <span class="log-type">[${log.type}]</span>
              <span class="log-msg">${log.message} ${log.data?.username ? `(${log.data.username})` : ''}</span>
            </div>
          `;
        }).join('');
        
        document.getElementById('app').innerHTML = `
          ${this.renderNav()}
          <main class="main wide">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:24px;">
              <div>
                <h1 style="font-size:2rem; margin-bottom:8px;">üõ°Ô∏è Developer Console</h1>
                <p style="color:var(--text-sec);">System Administration & Control</p>
              </div>
              <button class="btn btn-outline" onclick="Router.navigate('dev')">üîÑ Refresh</button>
            </div>
            
            <div class="dev-grid">
              <div class="dev-card">
                <h3>üë• Users</h3>
                <div class="stat-value">${stats.totalUsers}</div>
                <p style="color:var(--text-sec); font-size:0.875rem; margin-top:8px;">
                  ${stats.onlineUsers} online<br>
                  ${stats.shadowBanned} shadow banned
                </p>
              </div>
              <div class="dev-card">
                <h3>üìù Posts</h3>
                <div class="stat-value">${stats.totalPosts}</div>
                <p style="color:var(--text-sec); font-size:0.875rem; margin-top:8px;">
                  ${stats.permanentPosts} permanent
                </p>
              </div>
              <div class="dev-card">
                <h3>üíæ Storage</h3>
                <div class="stat-value">${Utils.formatBytes(storageUsed)}</div>
                <p style="color:var(--text-sec); font-size:0.875rem; margin-top:8px;">
                  LocalStorage used
                </p>
              </div>
              <div class="dev-card">
                <h3>‚ö° Actions</h3>
                <div style="display:flex; flex-direction:column; gap:8px; margin-top:8px;">
                  <button class="btn btn-small" onclick="Dev.exportData()">üì• Export All Data</button>
                  <button class="btn btn-small" onclick="Dev.showImportModal()">üì§ Import Data</button>
                  <button class="btn btn-small btn-danger" onclick="Dev.purgeAll()">üí• Purge Everything</button>
                </div>
              </div>
            </div>
            
            <div class="card" style="background:linear-gradient(135deg, rgba(255,221,87,0.1), transparent); border:1px solid var(--warning);">
              <h3 style="color:var(--warning); margin-bottom:16px;">üëª Account Impersonation</h3>
              <div style="display:flex; gap:12px; align-items:end; flex-wrap:wrap;">
                <div style="flex:1; min-width:200px;">
                  <select id="impersonate-target" style="width:100%; background:var(--bg);">
                    <option value="">Select user to impersonate...</option>
                    ${userOptions}
                  </select>
                </div>
                <button class="btn btn-warning" onclick="Dev.startImpersonating()">Start Impersonating</button>
              </div>
              ${impersonatingUser ? `
                <div style="margin-top:16px; padding:12px; background:rgba(0,0,0,0.3); border-radius:8px; display:flex; align-items:center; justify-content:space-between;">
                  <span>Currently impersonating: <strong>${impersonatingUser.displayName}</strong></span>
                  <button class="btn btn-small btn-danger" onclick="Dev.stopImpersonating()">Stop</button>
                </div>
              ` : ''}
            </div>
            
            <div class="card" style="padding:0; overflow:hidden; margin-top:24px;">
              <div style="padding:20px; border-bottom:1px solid rgba(255,255,255,0.1);">
                <h3>User Management</h3>
              </div>
              <div style="overflow-x:auto;">
                <table style="width:100%; border-collapse:collapse; font-size:0.875rem;">
                  <thead>
                    <tr style="background:var(--surface-light);">
                      <th style="padding:12px; text-align:left;">User</th>
                      <th style="padding:12px; text-align:left;">Status</th>
                      <th style="padding:12px; text-align:left;">Role</th>
                      <th style="padding:12px; text-align:left;">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${users.map(u => `
                      <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
                        <td style="padding:12px;">
                          <div style="display:flex; align-items:center; gap:12px;">
                            <div class="avatar small" style="width:32px; height:32px; font-size:0.9rem;">
                              ${u.avatar ? `<img src="${u.avatar}">` : u.displayName[0].toUpperCase()}
                            </div>
                            <div>
                              <div style="font-weight:600; display:flex; align-items:center; gap:4px;">
                                ${u.displayName}
                                ${u.isVerified ? '<span style="color:var(--accent);">‚úì</span>' : ''}
                              </div>
                              <div style="color:var(--text-sec); font-size:0.8rem;">@${u.username}</div>
                              ${u.lastIP ? `<div style="color:var(--text-sec); font-size:0.75rem; margin-top:2px;">IP: ${u.lastIP}</div>` : ''}
                            </div>
                          </div>
                        </td>
                        <td style="padding:12px;">
                          <div style="display:flex; align-items:center; gap:6px;">
                            <span style="display:inline-block; width:8px; height:8px; background:${u.isOnline ? 'var(--success)' : 'var(--text-sec)'}; border-radius:50%;"></span>
                            <span style="font-size:0.875rem; color:var(--text-sec);">${u.isOnline ? 'Online' : 'Offline'}</span>
                          </div>
                          ${u.shadowBanned ? '<div style="color:var(--danger); font-size:0.75rem; margin-top:4px;">üîá Shadow Banned</div>' : ''}
                          ${u.banned ? '<div style="color:var(--danger); font-size:0.75rem; margin-top:4px;">üö´ Banned</div>' : ''}
                        </td>
                        <td style="padding:12px;">
                          ${u.isDev ? '<span style="background:var(--accent); color:black; padding:4px 8px; border-radius:6px; font-size:0.75rem; font-weight:bold;">DEV</span>' : '<span style="color:var(--text-sec);">User</span>'}
                        </td>
                        <td style="padding:12px;">
                          ${!u.isDev ? `
                            <div style="display:flex; gap:6px; flex-wrap:wrap;">
                              <button class="btn btn-small" onclick="Dev.verify('${u.id}', ${!u.isVerified})" title="Verify">${u.isVerified ? '‚úì Unverify' : '‚úì Verify'}</button>
                              <button class="btn btn-small ${u.shadowBanned ? '' : 'btn-outline'}" onclick="Dev.shadowBan('${u.id}', ${!u.shadowBanned})" title="Shadow Ban" style="${u.shadowBanned ? 'background:#333; color:#999;' : ''}">
                                ${u.shadowBanned ? 'üîá Unshadow' : 'üîá Shadow'}
                              </button>
                              <button class="btn btn-small ${u.banned ? 'btn-danger' : 'btn-outline'}" onclick="Dev.ban('${u.id}', ${!u.banned})">
                                ${u.banned ? 'Unban' : 'Ban'}
                              </button>
                              <button class="btn btn-small btn-danger" onclick="Dev.massDeletePosts('${u.id}')">üóëÔ∏è Posts</button>
                              <button class="btn btn-small btn-warning" onclick="Dev.impersonate('${u.id}')">üëª</button>
                            </div>
                          ` : '<span style="color:var(--text-sec);">Protected</span>'}
                        </td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            </div>
            
            <div class="card" style="margin-top:24px;">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <h3>üìú System Logs (Last 20)</h3>
                <button class="btn btn-small btn-outline" onclick="SystemLog.clear(); Router.navigate('dev');">Clear Logs</button>
              </div>
              <div class="log-container">
                ${recentLogs || '<div style="color:var(--text-sec); text-align:center; padding:20px;">No logs yet</div>'}
              </div>
            </div>
          </main>
        `;
      }
    };
    
    // Auth
    const Auth = {
      handleLogin(e) {
        e.preventDefault();
        const username = document.getElementById('login-username').value;
        const password = document.getElementById('login-password').value;
        const errorDiv = document.getElementById('login-error');
        
        const users = DB.getUsers();
        const user = users.find(u => (u.username === username || u.email === username) && u.password === password);
        
        if (!user) {
          errorDiv.textContent = '‚ùå Invalid credentials';
          errorDiv.classList.add('show');
          SystemLog.add('AUTH_FAIL', 'Failed login attempt', { username });
          return;
        }
        
        if (user.banned) {
          errorDiv.textContent = `üö´ Account banned: ${user.banReason}`;
          errorDiv.classList.add('show');
          return;
        }
        
        user.isOnline = true;
        user.lastActive = new Date().toISOString();
        DB.saveUsers(users);
        
        currentUser = user;
        DB.saveCurrentUser(user);
        Utils.showToast(`Welcome back, ${user.displayName}!`);
        SystemLog.add('AUTH', 'User logged in', { username: user.username, id: user.id });
        Router.navigate('/');
      },
      
      // FIXED REGISTRATION FUNCTION
      handleRegister(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const errorDiv = document.getElementById('register-error');
        errorDiv.classList.remove('show');
        
        try {
          const username = document.getElementById('reg-username').value.trim();
          const email = document.getElementById('reg-email').value.trim();
          const password = document.getElementById('reg-password').value;
          const confirm = document.getElementById('reg-confirm').value;
          const displayName = document.getElementById('reg-display').value.trim();
          
          console.log('Registering:', username, email);
          
          // Validation checks
          if (!username || !email || !password) {
            throw new Error('Please fill in all required fields (marked with *)');
          }
          
          if (password !== confirm) {
            throw new Error("Passwords don't match");
          }
          
          if (password.length < 6) {
            throw new Error("Password must be at least 6 characters");
          }
          
          if (!/^[a-zA-Z0-9_]+$/.test(username)) {
            throw new Error("Username can only contain letters, numbers, and underscores");
          }
          
          const users = DB.getUsers();
          
          // Check duplicates
          if (users.find(u => u.username === username)) {
            throw new Error('Username already taken');
          }
          
          if (users.find(u => u.email === email)) {
            throw new Error('Email already registered');
          }
          
          // Create user
          const newUser = {
            id: Utils.generateId(),
            username: username,
            email: email,
            password: password,
            displayName: displayName || username,
            bio: '',
            avatar: null,
            cover: null,
            isVerified: false,
            isAdmin: false,
            isDev: false,
            isOnline: true,
            status: 'online',
            createdAt: new Date().toISOString(),
            followers: [],
            following: [],
            posts: 0,
            banned: false,
            shadowBanned: false,
            banReason: null,
            lastIP: null,
            metadata: {}
          };
          
          users.push(newUser);
          
          // Save to storage with error handling
          try {
            DB.saveUsers(users);
            DB.saveCurrentUser(newUser);
          } catch (storageErr) {
            console.error('Storage error:', storageErr);
            throw new Error('Browser storage full! Try incognito mode or clear data.');
          }
          
          currentUser = newUser;
          
          Utils.showToast('Account created successfully! üéâ', 'success');
          console.log('Registration complete:', username);
          SystemLog.add('AUTH', 'New user registered', { username });
          
          setTimeout(() => {
            Router.navigate('/');
          }, 500);
          
        } catch (error) {
          console.error('Registration failed:', error);
          errorDiv.textContent = error.message;
          errorDiv.classList.add('show');
          
          // Scroll to error
          errorDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      },
      
      logout() {
        if (currentUser) {
          const users = DB.getUsers();
          const idx = users.findIndex(u => u.id === currentUser.id);
          if (idx !== -1) {
            users[idx].isOnline = false;
            DB.saveUsers(users);
          }
          SystemLog.add('AUTH', 'User logged out', { username: currentUser.username });
        }
        impersonatingUser = null;
        currentUser = null;
        DB.saveCurrentUser(null);
        Utils.showToast('Logged out');
        Router.navigate('login');
      }
    };
    
    // Users
    const Users = {
      follow(userId) {
        const users = DB.getUsers();
        const currentIdx = users.findIndex(u => u.id === currentUser.id);
        const targetIdx = users.findIndex(u => u.id === userId);
        
        if (currentIdx === -1 || targetIdx === -1) return;
        
        const isFollowing = users[currentIdx].following.includes(userId);
        
        if (isFollowing) {
          users[currentIdx].following = users[currentIdx].following.filter(id => id !== userId);
          users[targetIdx].followers = users[targetIdx].followers.filter(id => id !== currentUser.id);
          Utils.showToast('Unfollowed');
        } else {
          users[currentIdx].following.push(userId);
          users[targetIdx].followers.push(currentUser.id);
          Utils.showToast('Following!');
        }
        
        DB.saveUsers(users);
        currentUser = users[currentIdx];
        DB.saveCurrentUser(currentUser);
        SystemLog.add('SOCIAL', `${isFollowing ? 'Unfollowed' : 'Followed'} user`, { target: users[targetIdx].username });
        Router.handle();
      },
      
      updateAvatar(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        if (file.size > 2 * 1024 * 1024) {
          Utils.showToast('Image too large. Max 2MB', 'error');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = (event) => {
          const users = DB.getUsers();
          const idx = users.findIndex(u => u.id === currentUser.id);
          if (idx !== -1) {
            users[idx].avatar = event.target.result;
            DB.saveUsers(users);
            currentUser = users[idx];
            DB.saveCurrentUser(currentUser);
            SystemLog.add('PROFILE', 'Avatar updated', { username: currentUser.username });
            Utils.showToast('Profile picture updated!', 'success');
            Router.handle();
            Views.showSettings();
          }
        };
        reader.readAsDataURL(file);
      },
      
      removeAvatar() {
        if (!confirm('Remove profile picture?')) return;
        const users = DB.getUsers();
        const idx = users.findIndex(u => u.id === currentUser.id);
        if (idx !== -1) {
          users[idx].avatar = null;
          DB.saveUsers(users);
          currentUser = users[idx];
          DB.saveCurrentUser(currentUser);
          Utils.showToast('Profile picture removed');
          Router.handle();
          Views.showSettings();
        }
      },
      
      saveSettings(e) {
        e.preventDefault();
        const name = document.getElementById('settings-name').value;
        const bio = document.getElementById('settings-bio').value;
        const email = document.getElementById('settings-email').value;
        
        const users = DB.getUsers();
        const idx = users.findIndex(u => u.id === currentUser.id);
        if (idx !== -1) {
          users[idx].displayName = name;
          users[idx].bio = bio;
          users[idx].email = email;
          DB.saveUsers(users);
          currentUser = users[idx];
          DB.saveCurrentUser(currentUser);
          Utils.showToast('Settings saved!', 'success');
          SystemLog.add('PROFILE', 'Profile updated', { username: currentUser.username });
        }
      },
      
      deleteAccount() {
        if (!confirm('‚ö†Ô∏è DELETE ACCOUNT?\n\nThis will permanently remove all your data. This cannot be undone!\n\nType "DELETE" to confirm.')) return;
        
        if (prompt('Type DELETE to confirm:') !== 'DELETE') {
          Utils.showToast('Account deletion cancelled', 'error');
          return;
        }
        
        let users = DB.getUsers().filter(u => u.id !== currentUser.id);
        let posts = DB.getPosts().filter(p => p.userId !== currentUser.id);
        DB.saveUsers(users);
        DB.savePosts(posts);
        SystemLog.add('ADMIN', 'User deleted own account', { username: currentUser.username });
        Auth.logout();
        Utils.showToast('Account deleted permanently');
      }
    };
    
    // Posts
    const Posts = {
      previewMedia(e) {
        const file = e.target.files[0];
        if (!file) return;
        if (file.size > 5 * 1024 * 1024) {
          Utils.showToast('File too large. Max 5MB.', 'error');
          return;
        }
        currentMediaFile = file;
        const reader = new FileReader();
        reader.onload = (event) => {
          const preview = document.getElementById('media-preview');
          preview.innerHTML = `
            <div style="margin-top:12px; position:relative; display:inline-block;">
              ${file.type.startsWith('video/') 
                ? `<video src="${event.target.result}" controls style="max-height:200px; border-radius:12px;"></video>`
                : `<img src="${event.target.result}" style="max-height:200px; border-radius:12px;">`
              }
              <button onclick="Posts.clearMedia()" style="position:absolute; top:8px; right:8px; background:var(--danger); color:white; border:none; width:28px; height:28px; border-radius:50%; cursor:pointer;">√ó</button>
            </div>
          `;
        };
        reader.readAsDataURL(file);
      },
      
      clearMedia() {
        currentMediaFile = null;
        document.getElementById('post-media').value = '';
        document.getElementById('media-preview').innerHTML = '';
      },
      
      create() {
        const content = document.getElementById('post-content').value;
        if (!content.trim() && !currentMediaFile) {
          Utils.showToast('Write something first!', 'error');
          return;
        }
        
        const postingAs = impersonatingUser || currentUser;
        const isImpersonating = !!impersonatingUser;
        
        if (postingAs.shadowBanned && !isImpersonating) {
          Utils.showToast('Posted! (Pending review)');
        }
        
        const posts = DB.getPosts();
        const newPost = {
          id: Utils.generateId(),
          userId: postingAs.id,
          content: content,
          type: currentMediaFile ? (currentMediaFile.type.startsWith('video/') ? 'video' : 'image') : 'text',
          mediaUrl: null,
          likes: [],
          comments: [],
          shares: 0,
          createdAt: new Date().toISOString(),
          isDevImpersonated: isImpersonating,
          permanent: isImpersonating,
          originalPosterId: isImpersonating ? currentUser.id : null
        };
        
        const savePost = () => {
          posts.unshift(newPost);
          DB.savePosts(posts);
          
          const users = DB.getUsers();
          const idx = users.findIndex(u => u.id === postingAs.id);
          if (idx !== -1) {
            users[idx].posts = (users[idx].posts || 0) + 1;
            DB.saveUsers(users);
          }
          
          currentMediaFile = null;
          SystemLog.add('POST', `${isImpersonating ? 'Impersonated' : 'Created'} post`, { user: postingAs.username, postId: newPost.id });
          
          if (isImpersonating) {
            Utils.showToast(`üîí Posted as ${postingAs.displayName} (PERMANENT)`, 'success');
          } else {
            Utils.showToast('Posted!', 'success');
          }
          
          Router.navigate('/');
        };
        
        if (currentMediaFile) {
          const reader = new FileReader();
          reader.onload = (e) => {
            newPost.mediaUrl = e.target.result;
            savePost();
          };
          reader.readAsDataURL(currentMediaFile);
        } else {
          savePost();
        }
      },
      
      like(postId) {
        const posts = DB.getPosts();
        const idx = posts.findIndex(p => p.id === postId);
        if (idx === -1) return;
        
        const isLiked = posts[idx].likes.includes(currentUser.id);
        if (isLiked) {
          posts[idx].likes = posts[idx].likes.filter(id => id !== currentUser.id);
        } else {
          posts[idx].likes.push(currentUser.id);
        }
        DB.savePosts(posts);
        Router.handle();
      },
      
      toggleComments(postId) {
        const el = document.getElementById(`comments-${postId}`);
        if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none';
      },
      
      comment(postId) {
        const input = document.getElementById(`comment-input-${postId}`);
        const content = input.value.trim();
        if (!content) return;
        
        const posts = DB.getPosts();
        const idx = posts.findIndex(p => p.id === postId);
        if (idx === -1) return;
        
        posts[idx].comments.push({
          id: Utils.generateId(),
          userId: currentUser.id,
          content,
          createdAt: new Date().toISOString()
        });
        DB.savePosts(posts);
        SystemLog.add('COMMENT', 'Comment added', { postId });
        Router.handle();
      },
      
      delete(postId) {
        const posts = DB.getPosts();
        const post = posts.find(p => p.id === postId);
        if (!post) return;
        
        if (post.permanent && !currentUser.isDev) {
          Utils.showToast('This post is permanent', 'error');
          return;
        }
        
        if (!confirm(post.permanent ? '‚ö†Ô∏è Delete PERMANENT post?' : 'Delete this post?')) return;
        
        let newPosts = posts.filter(p => p.id !== postId);
        DB.savePosts(newPosts);
        
        const users = DB.getUsers();
        const userIdx = users.findIndex(u => u.id === post.userId);
        if (userIdx !== -1) {
          users[userIdx].posts = Math.max(0, (users[userIdx].posts || 0) - 1);
          DB.saveUsers(users);
        }
        
        SystemLog.add('ADMIN', 'Post deleted', { postId, by: currentUser.username });
        Utils.showToast('Post deleted');
        Router.handle();
      },
      
      edit(postId) {
        const posts = DB.getPosts();
        const post = posts.find(p => p.id === postId);
        if (!post) return;
        
        if (!currentUser.isDev && post.userId !== currentUser.id) {
          Utils.showToast('Cannot edit this post', 'error');
          return;
        }
        
        const newContent = prompt('Edit post:', post.content);
        if (newContent === null) return;
        if (!newContent.trim()) {
          Utils.showToast('Post cannot be empty', 'error');
          return;
        }
        
        post.content = newContent;
        post.editedAt = new Date().toISOString();
        post.editedBy = currentUser.id;
        DB.savePosts(posts);
        SystemLog.add('ADMIN', 'Post edited', { postId, by: currentUser.username });
        Utils.showToast('Post updated');
        Router.handle();
      }
    };
    
    // Dev Tools
    const Dev = {
      verify(userId, verify) {
        const users = DB.getUsers();
        const idx = users.findIndex(u => u.id === userId);
        if (idx !== -1) {
          users[idx].isVerified = verify;
          DB.saveUsers(users);
          SystemLog.add('ADMIN', `User ${verify ? 'verified' : 'unverified'}`, { user: users[idx].username });
          Utils.showToast(verify ? 'User verified' : 'Verification removed');
          Router.navigate('dev');
        }
      },
      
      ban(userId, ban) {
        const users = DB.getUsers();
        const idx = users.findIndex(u => u.id === userId);
        if (idx === -1) return;
        
        if (ban) {
          const reason = prompt('Ban reason:');
          if (!reason) return;
          users[idx].banned = true;
          users[idx].banReason = reason;
          SystemLog.add('ADMIN', 'User banned', { user: users[idx].username, reason });
          Utils.showToast('User banned');
        } else {
          users[idx].banned = false;
          users[idx].banReason = null;
          SystemLog.add('ADMIN', 'User unbanned', { user: users[idx].username });
          Utils.showToast('User unbanned');
        }
        DB.saveUsers(users);
        Router.navigate('dev');
      },
      
      shadowBan(userId, ban) {
        const users = DB.getUsers();
        const idx = users.findIndex(u => u.id === userId);
        if (idx !== -1) {
          users[idx].shadowBanned = ban;
          DB.saveUsers(users);
          SystemLog.add('ADMIN', `User ${ban ? 'shadow banned' : 'unshadow banned'}`, { user: users[idx].username });
          Utils.showToast(ban ? 'üîá User shadow banned' : 'User restored');
          Router.navigate('dev');
        }
      },
      
      massDeletePosts(userId) {
        if (!confirm('Delete ALL posts from this user?')) return;
        let posts = DB.getPosts().filter(p => p.userId !== userId);
        DB.savePosts(posts);
        const users = DB.getUsers();
        const user = users.find(u => u.id === userId);
        if (user) {
          user.posts = 0;
          DB.saveUsers(users);
        }
        SystemLog.add('ADMIN', 'Mass deleted user posts', { user: user?.username });
        Utils.showToast('All posts deleted');
        Router.navigate('dev');
      },
      
      impersonate(userId) {
        const users = DB.getUsers();
        const target = users.find(u => u.id === userId);
        if (target) {
          impersonatingUser = target;
          Utils.showToast(`Impersonating ${target.displayName}`, 'warning');
          SystemLog.add('ADMIN', 'Started impersonation', { target: target.username, by: currentUser.username });
          Router.navigate('/');
        }
      },
      
      startImpersonating() {
        const select = document.getElementById('impersonate-target');
        if (select && select.value) {
          this.impersonate(select.value);
        } else {
          Utils.showToast('Select a user', 'error');
        }
      },
      
      stopImpersonating() {
        if (impersonatingUser) {
          SystemLog.add('ADMIN', 'Stopped impersonation', { target: impersonatingUser.username });
          impersonatingUser = null;
          Utils.showToast('Stopped impersonating');
          Router.navigate('/');
        }
      },
      
      exportData() {
        const data = DB.exportAll();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `netsphere_backup_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        SystemLog.add('SYSTEM', 'Data exported');
        Utils.showToast('Data exported!', 'success');
      },
      
      showImportModal() {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay show';
        modal.innerHTML = `
          <div class="modal">
            <h3 style="color:var(--danger); margin-bottom:16px;">‚ö†Ô∏è Import Data</h3>
            <p style="color:var(--text-sec); margin-bottom:16px; font-size:0.875rem;">
              This will OVERWRITE all current data. Make sure you have a backup!
            </p>
            <input type="file" id="import-file" accept=".json" style="margin-bottom:16px;">
            <div style="display:flex; gap:12px;">
              <button class="btn btn-outline" style="flex:1;" onclick="this.closest('.modal-overlay').remove()">Cancel</button>
              <button class="btn btn-danger" style="flex:1;" onclick="Dev.importData()">Import</button>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
      },
      
      importData() {
        const file = document.getElementById('import-file').files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (DB.importAll(data)) {
              SystemLog.add('SYSTEM', 'Data imported');
              Utils.showToast('Data imported! Reloading...', 'success');
              setTimeout(() => location.reload(), 1500);
            } else {
              Utils.showToast('Invalid data format', 'error');
            }
          } catch(err) {
            Utils.showToast('Error reading file', 'error');
          }
        };
        reader.readAsText(file);
      },
      
      purgeAll() {
        if (!confirm('üí• DELETE EVERYTHING?\n\nThis wipes ALL users, posts, and logs.\nThis cannot be undone!\n\nType PURGE to confirm:')) return;
        if (prompt('Type PURGE to confirm:') !== 'PURGE') return;
        
        localStorage.removeItem(DB.KEYS.USERS);
        localStorage.removeItem(DB.KEYS.POSTS);
        localStorage.removeItem('ns_logs');
        localStorage.removeItem('ns_dev_unlocked');
        SystemLog.add('SYSTEM', 'COMPLETE DATA PURGE');
        Utils.showToast('Everything deleted. Reloading...', 'error');
        setTimeout(() => location.reload(), 2000);
      }
    };
    
    // Init
    window.addEventListener('DOMContentLoaded', () => {
      Views.init();
    });
    
    window.addEventListener('hashchange', () => {
      Router.handle();
    });
    
    // Expose globals
    window.Router = Router;
    window.Posts = Posts;
    window.Users = Users;
    window.Dev = Dev;
    window.Auth = Auth;
    window.Views = Views;
    window.SystemLog = SystemLog;
    window.DB = DB;
  </script>
</body>
</html>
