<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NetSphere - Social Platform</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #0f0f13;
      --surface: #1a1a20;
      --surface-light: #252530;
      --accent: #00d4ff;
      --accent-secondary: #7000ff;
      --text: #ffffff;
      --text-sec: #a0a0b0;
      --danger: #ff3860;
      --warning: #ffdd57;
      --success: #23d160;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(0, 212, 255, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(112, 0, 255, 0.1) 0%, transparent 20%);
    }
    
    /* 3D LOGO STYLES */
    .logo-container {
      position: relative;
      width: 60px;
      height: 60px;
      cursor: pointer;
      display: inline-block;
    }
    
    .logo-sphere {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      animation: rotate 10s linear infinite;
    }
    
    @keyframes rotate {
      from { transform: rotateY(0deg) rotateX(10deg); }
      to { transform: rotateY(360deg) rotateX(10deg); }
    }
    
    .logo-ring {
      position: absolute;
      width: 100%;
      height: 100%;
      border: 3px solid var(--accent);
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.5), inset 0 0 20px rgba(0, 212, 255, 0.2);
    }
    
    .logo-ring:nth-child(1) { transform: rotateY(0deg); }
    .logo-ring:nth-child(2) { transform: rotateY(60deg); }
    .logo-ring:nth-child(3) { transform: rotateY(120deg); }
    
    .logo-n {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-weight: 800;
      font-size: 1.5rem;
      color: var(--text);
      text-shadow: 0 0 10px var(--accent);
      z-index: 10;
      pointer-events: none;
    }
    
    .logo-pulse {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 2px solid var(--accent);
      animation: pulse 2s ease-out infinite;
      opacity: 0;
    }
    
    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
      100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
    }
    
    /* Error Messages */
    .error-msg {
      display: none;
      background: rgba(255, 56, 96, 0.2);
      color: var(--danger);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      border: 1px solid var(--danger);
      font-size: 0.9rem;
    }
    .error-msg.show { display: block; }
    
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      margin-bottom: 6px;
      color: var(--text);
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    input, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      font-size: 1rem;
      font-family: inherit;
      background: var(--surface-light);
      color: var(--text);
      outline: none;
    }
    input:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
    }
    
    /* Buttons */
    .btn {
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: inherit;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
    }
    .btn-outline {
      background: transparent;
      border: 2px solid rgba(255,255,255,0.1);
      color: var(--text);
    }
    .btn-outline:hover {
      border-color: var(--accent);
      background: rgba(0, 212, 255, 0.1);
    }
    .btn-danger {
      background: var(--danger);
    }
    .btn-warning {
      background: var(--warning);
      color: var(--bg);
    }
    .btn-small {
      padding: 6px 12px;
      font-size: 0.875rem;
    }
    
    /* Auth Pages */
    .auth-page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      position: relative;
    }
    
    .auth-bg {
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(circle at 20% 50%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 50%, rgba(112, 0, 255, 0.1) 0%, transparent 50%);
      animation: bgRotate 20s linear infinite;
    }
    
    @keyframes bgRotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .auth-card {
      background: var(--surface);
      border-radius: 32px;
      padding: 40px;
      width: 100%;
      max-width: 420px;
      border: 1px solid rgba(255,255,255,0.1);
      position: relative;
      z-index: 1;
    }
    
    .brand-text {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* Dev Hint */
    .dev-reveal {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(112, 0, 255, 0.1));
      border: 1px solid rgba(0, 212, 255, 0.3);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      display: none;
    }
    .dev-reveal.show { display: block; }
    
    /* Navigation */
    .nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: rgba(15, 15, 19, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      z-index: 100;
      padding: 0 20px;
    }
    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 70px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
    }
    .nav-links {
      display: flex;
      gap: 8px;
    }
    .nav-link {
      padding: 10px 20px;
      border-radius: 20px;
      color: var(--text-sec);
      font-weight: 500;
      transition: all 0.3s;
      cursor: pointer;
      border: none;
      background: transparent;
      font-family: inherit;
      font-size: 0.95rem;
      color: var(--text);
    }
    .nav-link:hover {
      background: rgba(255,255,255,0.05);
    }
    .nav-link.dev {
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      font-weight: 600;
    }
    
    /* Main Layout */
    .main {
      padding-top: 90px;
      max-width: 800px;
      margin: 0 auto;
      padding-bottom: 40px;
      padding-left: 20px;
      padding-right: 20px;
    }
    .main.wide { max-width: 1200px; }
    
    /* Cards */
    .card {
      background: var(--surface);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    /* Avatar */
    .avatar {
      width: 48px; height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
      flex-shrink: 0;
      border: 2px solid rgba(255,255,255,0.1);
      overflow: hidden;
    }
    .avatar.large { width: 120px; height: 120px; font-size: 3rem; }
    .avatar.small { width: 32px; height: 32px; font-size: 0.9rem; }
    .avatar img { width: 100%; height: 100%; object-fit: cover; }
    
    /* Profile */
    .cover-image {
      height: 200px;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      border-radius: 20px 20px 0 0;
    }
    .profile-info {
      padding: 0 24px 24px;
      position: relative;
    }
    .profile-avatar-wrapper {
      margin-top: -60px;
      position: relative;
      display: inline-block;
    }
    .profile-stats {
      display: flex;
      gap: 24px;
      margin-top: 16px;
      border-top: 1px solid rgba(255,255,255,0.1);
      padding-top: 16px;
    }
    
    /* Dev Panel */
    .dev-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }
    .dev-card {
      background: var(--surface);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 20px;
    }
    .dev-card h3 {
      margin-bottom: 16px;
      color: var(--accent);
    }
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    th { color: var(--text-sec); }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }
    .modal {
      background: var(--surface);
      border-radius: 24px;
      padding: 24px;
      width: 100%;
      max-width: 500px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .secret-input {
      letter-spacing: 0.5em;
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      background: var(--bg);
      border: 2px solid rgba(0, 212, 255, 0.3);
    }
    
    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 300;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .toast {
      background: var(--surface);
      color: var(--text);
      padding: 16px 24px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      animation: slideIn 0.3s;
      max-width: 400px;
      border-left: 4px solid var(--accent);
    }
    .toast.error { border-left-color: var(--danger); }
    .toast.success { border-left-color: var(--success); }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .click-hint {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.7rem;
      color: var(--accent);
      opacity: 0;
      transition: opacity 0.3s;
      white-space: nowrap;
      background: rgba(0,0,0,0.8);
      padding: 4px 8px;
      border-radius: 4px;
      pointer-events: none;
    }
    .click-hint.show { opacity: 1; }
    
    @media (max-width: 768px) {
      .nav-links { display: none; }
      .dev-grid { grid-template-columns: 1fr; }
    }
  </style>
<base target="_blank">
</head>
<body>
  <div id="app"></div>
  <div class="toast-container" id="toast-container"></div>

  <script>
    // Config
    const SECRET_CODE = '020212';
    const LOGO_CLICKS_REQUIRED = 20;
    let logoClickCount = 0;
    let devHintUnlocked = localStorage.getItem('ns_dev_unlocked') === 'true';
    let impersonatingUser = null;
    let currentMediaFile = null;

    // Database
    const DB = {
      KEYS: {
        USERS: 'ns_users_v3',
        POSTS: 'ns_posts_v3',
        CURRENT_USER: 'ns_current_v3'
      },
      getUsers() {
        try { return JSON.parse(localStorage.getItem(this.KEYS.USERS)) || []; }
        catch(e) { return []; }
      },
      getPosts() {
        try { return JSON.parse(localStorage.getItem(this.KEYS.POSTS)) || []; }
        catch(e) { return []; }
      },
      getCurrentUser() {
        try { return JSON.parse(localStorage.getItem(this.KEYS.CURRENT_USER)); }
        catch(e) { return null; }
      },
      saveUsers(users) {
        localStorage.setItem(this.KEYS.USERS, JSON.stringify(users));
      },
      savePosts(posts) {
        localStorage.setItem(this.KEYS.POSTS, JSON.stringify(posts));
      },
      saveCurrentUser(user) {
        localStorage.setItem(this.KEYS.CURRENT_USER, JSON.stringify(user));
      },
      init() {
        const users = this.getUsers();
        // Create dev account if not exists
        if (!users.find(u => u.username === 'jayjay')) {
          users.push({
            id: 'dev-' + Date.now(),
            username: 'jayjay',
            email: 'dev@netsphere.com',
            password: '2012!',
            displayName: 'JayJay',
            bio: 'System Administrator üë®‚Äçüíª | NetSphere Creator',
            avatar: null,
            isVerified: true,
            isAdmin: true,
            isDev: true,
            isOnline: true,
            createdAt: new Date().toISOString(),
            followers: [],
            following: [],
            posts: 0,
            banned: false,
            shadowBanned: false,
            banReason: null,
            metadata: {}
          });
          this.saveUsers(users);
          console.log('Dev account created: jayjay / 2012!');
        }
      }
    };
    DB.init();

    let currentUser = DB.getCurrentUser();

    const Utils = {
      generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
      },
      showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      },
      formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;
        const minutes = Math.floor(diff / 60000);
        if (minutes < 1) return 'Just now';
        if (minutes < 60) return `${minutes}m ago`;
        const hours = Math.floor(diff / 3600000);
        if (hours < 24) return `${hours}h ago`;
        const days = Math.floor(diff / 86400000);
        if (days < 7) return `${days}d ago`;
        return date.toLocaleDateString();
      },
      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
    };

    // Router
    const Router = {
      navigate(path) {
        window.location.hash = path;
      },
      handle() {
        const hash = window.location.hash.slice(1) || '/';
        const [route, ...params] = hash.split('/');
        
        if (!currentUser && route !== 'login' && route !== 'register') {
          this.navigate('login');
          return;
        }
        if (currentUser && (route === 'login' || route === 'register')) {
          this.navigate('/');
          return;
        }
        
        switch(route) {
          case 'login':
            Views.showLogin();
            break;
          case 'register':
            Views.showRegister();
            break;
          case 'profile':
            Views.showProfile(params[0] || currentUser.username);
            break;
          case 'dev':
            if (currentUser?.isDev) Views.showDevPanel();
            else this.navigate('/');
            break;
          default:
            Views.showHome();
        }
      }
    };

    window.handleLogoClick = function() {
      logoClickCount++;
      const hint = document.getElementById('click-hint');
      if (hint) {
        hint.textContent = `${LOGO_CLICKS_REQUIRED - logoClickCount} clicks to unlock...`;
        hint.classList.add('show');
        setTimeout(() => hint && hint.classList.remove('show'), 1500);
      }
      if (logoClickCount >= LOGO_CLICKS_REQUIRED) {
        logoClickCount = 0;
        Views.showSecretModal();
      }
    };

    window.checkSecretCode = function() {
      const input = document.getElementById('secret-code').value;
      if (input === SECRET_CODE) {
        devHintUnlocked = true;
        localStorage.setItem('ns_dev_unlocked', 'true');
        document.querySelector('.modal-overlay').remove();
        Utils.showToast('üîì Developer access granted!', 'success');
        Router.handle();
      } else {
        document.getElementById('code-error').style.display = 'block';
        document.getElementById('code-error').textContent = '‚ùå Invalid code';
        document.getElementById('secret-code').value = '';
      }
    };

    const Views = {
      renderLogo() {
        return `
          <div class="logo-container" onclick="handleLogoClick()">
            <div class="logo-sphere">
              <div class="logo-ring"></div>
              <div class="logo-ring"></div>
              <div class="logo-ring"></div>
              <div class="logo-pulse"></div>
            </div>
            <div class="logo-n">N</div>
            <span class="click-hint" id="click-hint">20 clicks to unlock...</span>
          </div>
        `;
      },
      renderNav() {
        const isDev = currentUser?.isDev;
        return `
          <nav class="nav">
            <div class="nav-inner">
              <div class="brand">
                ${this.renderLogo()}
                <span class="brand-text">NetSphere</span>
              </div>
              <div class="nav-links">
                <button class="nav-link" onclick="Router.navigate('/')">üè† Home</button>
                <button class="nav-link" onclick="Router.navigate('profile/${currentUser.username}')">üë§ Profile</button>
                ${isDev ? `<button class="nav-link dev" onclick="Router.navigate('dev')">üõ°Ô∏è Dev</button>` : ''}
                <button class="nav-link" onclick="Auth.logout()">üö™ Logout</button>
              </div>
            </div>
          </nav>
        `;
      },
      showSecretModal() {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay show';
        modal.innerHTML = `
          <div class="modal">
            <h2 style="color:var(--accent); margin-bottom:20px;">üîí Developer Access</h2>
            <p style="margin-bottom:20px; color:var(--text-sec);">Enter the secret code:</p>
            <div id="code-error" style="display:none; background:rgba(255,56,96,0.2); color:var(--danger); padding:12px; border-radius:8px; margin-bottom:16px; border:1px solid var(--danger);"></div>
            <input type="password" id="secret-code" class="secret-input" placeholder="000000" maxlength="6">
            <button class="btn w-full" style="margin-top:20px; width:100%;" onclick="checkSecretCode()">Unlock Access</button>
          </div>
        `;
        document.body.appendChild(modal);
        document.getElementById('secret-code').focus();
      },
      showLogin() {
        document.getElementById('app').innerHTML = `
          <div class="auth-page">
            <div class="auth-bg"></div>
            <div class="auth-card">
              <div style="text-align:center; margin-bottom:30px;">
                <div style="display:inline-block; margin-bottom:16px;">
                  ${this.renderLogo()}
                </div>
                <h1 style="font-size:2rem; margin-bottom:8px;">NetSphere</h1>
                <p style="color:var(--text-sec);">Your World, One Scroll</p>
              </div>
              
              <div class="dev-reveal ${devHintUnlocked ? 'show' : ''}">
                <strong style="color:var(--accent);">üë®‚Äçüíª Developer Access Granted</strong><br>
                <div style="margin-top:8px; font-size:0.9rem;">
                  Username: <code style="background:rgba(0,0,0,0.3); padding:2px 6px; border-radius:4px;">jayjay</code><br>
                  Password: <code style="background:rgba(0,0,0,0.3); padding:2px 6px; border-radius:4px;">2012!</code>
                </div>
                <button class="btn w-full" style="margin-top:10px; width:100%;" onclick="document.getElementById('login-username').value='jayjay';document.getElementById('login-password').value='2012!'">Auto-fill Dev Account</button>
              </div>
              
              <div id="login-error" class="error-msg"></div>
              
              <form id="login-form">
                <div class="form-group">
                  <label>Username</label>
                  <input type="text" id="login-username" required placeholder="Enter username">
                </div>
                <div class="form-group">
                  <label>Password</label>
                  <input type="password" id="login-password" required placeholder="Enter password">
                </div>
                <button type="submit" class="btn" style="width:100%;">Log In</button>
              </form>
              
              <p style="text-align:center; margin-top:20px; color:var(--text-sec);">
                Don't have an account? 
                <a href="#register" style="color:var(--accent); text-decoration:none; font-weight:600;">Sign up</a>
              </p>
            </div>
          </div>
        `;
        document.getElementById('login-form').addEventListener('submit', Auth.handleLogin);
      },
      showRegister() {
        document.getElementById('app').innerHTML = `
          <div class="auth-page">
            <div class="auth-bg"></div>
            <div class="auth-card">
              <h1 style="text-align:center; margin-bottom:8px;">Create Account</h1>
              <p style="text-align:center; color:var(--text-sec); margin-bottom:24px;">Join the network</p>
              
              <div id="register-error" class="error-msg"></div>
              
              <form id="register-form">
                <div class="form-group">
                  <label>Username *</label>
                  <input type="text" id="reg-username" required placeholder="Choose username (letters, numbers, _)">
                </div>
                <div class="form-group">
                  <label>Email *</label>
                  <input type="email" id="reg-email" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                  <label>Display Name</label>
                  <input type="text" id="reg-display" placeholder="Your name">
                </div>
                <div class="form-group">
                  <label>Password *</label>
                  <input type="password" id="reg-password" required minlength="6" placeholder="Min 6 characters">
                </div>
                <div class="form-group">
                  <label>Confirm Password *</label>
                  <input type="password" id="reg-confirm" required placeholder="Confirm password">
                </div>
                <button type="submit" class="btn" style="width:100%;">Create Account</button>
              </form>
              
              <p style="text-align:center; margin-top:20px; color:var(--text-sec);">
                Already have an account? 
                <a href="#login" style="color:var(--accent); text-decoration:none; font-weight:600;">Log in</a>
              </p>
            </div>
          </div>
        `;
        document.getElementById('register-form').addEventListener('submit', Auth.handleRegister);
      },
      showHome() {
        document.getElementById('app').innerHTML = `
          ${this.renderNav()}
          <main class="main">
            <div class="card">
              <div style="display:flex; align-items:center; gap:16px;">
                <div class="avatar" style="width:60px; height:60px; font-size:1.5rem;">
                  ${currentUser.displayName[0].toUpperCase()}
                </div>
                <div>
                  <h2>Welcome back, ${currentUser.displayName}!</h2>
                  ${currentUser.isDev ? '<span style="color:var(--accent); font-size:0.875rem;">üõ°Ô∏è Developer Mode</span>' : ''}
                </div>
              </div>
            </div>
            <div class="card">
              <h3>Account Info</h3>
              <p style="color:var(--text-sec); margin-top:8px;">Username: @${currentUser.username}</p>
              <p style="color:var(--text-sec);">Email: ${currentUser.email}</p>
              <p style="color:var(--text-sec);">Joined: ${Utils.formatDate(currentUser.createdAt)}</p>
            </div>
          </main>
        `;
      },
      showProfile(username) {
        const users = DB.getUsers();
        const profile = users.find(u => u.username === username);
        if (!profile) {
          Utils.showToast('User not found', 'error');
          return;
        }
        const isFollowing = profile.followers?.includes(currentUser.id);
        const isOwn = currentUser.id === profile.id;
        
        document.getElementById('app').innerHTML = `
          ${this.renderNav()}
          <main class="main">
            <div class="card" style="padding:0;">
              <div class="cover-image"></div>
              <div class="profile-info">
                <div class="profile-avatar-wrapper">
                  <div class="avatar large">${profile.displayName[0].toUpperCase()}</div>
                </div>
                <h1 style="margin-top:16px;">${profile.displayName}</h1>
                <p style="color:var(--text-sec);">@${profile.username}</p>
                ${profile.bio ? `<p style="margin-top:12px;">${Utils.escapeHtml(profile.bio)}</p>` : ''}
                
                <div class="profile-stats">
                  <div><strong>${profile.followers?.length || 0}</strong><span style="color:var(--text-sec); display:block; font-size:0.875rem;">Followers</span></div>
                  <div><strong>${profile.following?.length || 0}</strong><span style="color:var(--text-sec); display:block; font-size:0.875rem;">Following</span></div>
                </div>
                
                ${!isOwn ? `
                  <button class="btn ${isFollowing ? 'btn-outline' : ''}" style="margin-top:16px;" onclick="Users.follow('${profile.id}')">
                    ${isFollowing ? 'Following' : 'Follow'}
                  </button>
                ` : ''}
              </div>
            </div>
          </main>
        `;
      },
      showDevPanel() {
        const users = DB.getUsers();
        const stats = {
          totalUsers: users.length,
          onlineUsers: users.filter(u => u.isOnline).length
        };
        
        document.getElementById('app').innerHTML = `
          ${this.renderNav()}
          <main class="main wide">
            <h1 style="margin-bottom:24px;">üõ°Ô∏è Developer Console</h1>
            
            <div class="dev-grid">
              <div class="dev-card">
                <h3>üë• Users</h3>
                <div class="stat-value">${stats.totalUsers}</div>
                <p style="color:var(--text-sec); margin-top:8px;">${stats.onlineUsers} online</p>
              </div>
              <div class="dev-card">
                <h3>‚ö° Actions</h3>
                <button class="btn btn-small btn-danger" style="margin-top:8px;" onclick="Dev.purgeAll()">üí• Purge All Data</button>
              </div>
            </div>
            
            <div class="card">
              <h3 style="margin-bottom:16px;">User Management</h3>
              <div style="overflow-x:auto;">
                <table>
                  <thead>
                    <tr>
                      <th>User</th>
                      <th>Role</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${users.map(u => `
                      <tr>
                        <td>
                          <div style="font-weight:600;">${u.displayName}</div>
                          <div style="color:var(--text-sec); font-size:0.8rem;">@${u.username}</div>
                        </td>
                        <td>${u.isDev ? '<span style="color:var(--accent);">Developer</span>' : 'User'}</td>
                        <td>
                          ${!u.isDev ? `
                            <button class="btn btn-small btn-danger" onclick="Dev.deleteUser('${u.id}')">Delete</button>
                          ` : '<span style="color:var(--text-sec);">Protected</span>'}
                        </td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            </div>
          </main>
        `;
      }
    };

    const Auth = {
      handleLogin(e) {
        e.preventDefault();
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value;
        const errorDiv = document.getElementById('login-error');
        
        const users = DB.getUsers();
        const user = users.find(u => u.username === username && u.password === password);
        
        if (!user) {
          errorDiv.textContent = '‚ùå Invalid username or password';
          errorDiv.classList.add('show');
          return;
        }
        if (user.banned) {
          errorDiv.textContent = 'üö´ Account banned: ' + user.banReason;
          errorDiv.classList.add('show');
          return;
        }
        
        user.isOnline = true;
        DB.saveUsers(users);
        currentUser = user;
        DB.saveCurrentUser(user);
        Utils.showToast(`Welcome back, ${user.displayName}!`);
        Router.navigate('/');
      },
      
      handleRegister(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const errorDiv = document.getElementById('register-error');
        errorDiv.classList.remove('show');
        
        try {
          const username = document.getElementById('reg-username').value.trim().toLowerCase();
          const email = document.getElementById('reg-email').value.trim();
          const password = document.getElementById('reg-password').value;
          const confirm = document.getElementById('reg-confirm').value;
          const displayName = document.getElementById('reg-display').value.trim() || username;
          
          if (!/^[a-z0-9_]+$/.test(username)) {
            throw new Error("Username: only lowercase letters, numbers, underscores allowed");
          }
          if (password !== confirm) throw new Error("Passwords don't match");
          if (password.length < 6) throw new Error("Password too short (min 6 chars)");
          
          const users = DB.getUsers();
          if (users.find(u => u.username === username)) throw new Error("Username taken");
          if (users.find(u => u.email === email)) throw new Error("Email already registered");
          
          const newUser = {
            id: Utils.generateId(),
            username,
            email,
            password,
            displayName,
            isVerified: false,
            isDev: false,
            isOnline: true,
            createdAt: new Date().toISOString(),
            followers: [],
            following: [],
            bio: ''
          };
          
          users.push(newUser);
          DB.saveUsers(users);
          currentUser = newUser;
          DB.saveCurrentUser(newUser);
          
          Utils.showToast('Account created successfully!', 'success');
          setTimeout(() => Router.navigate('/'), 500);
          
        } catch (err) {
          console.error(err);
          errorDiv.textContent = err.message;
          errorDiv.classList.add('show');
        }
      },
      
      logout() {
        if (currentUser) {
          const users = DB.getUsers();
          const idx = users.findIndex(u => u.id === currentUser.id);
          if (idx !== -1) {
            users[idx].isOnline = false;
            DB.saveUsers(users);
          }
        }
        currentUser = null;
        DB.saveCurrentUser(null);
        Utils.showToast('Logged out');
        Router.navigate('login');
      }
    };

    const Users = {
      follow(userId) {
        const users = DB.getUsers();
        const currentIdx = users.findIndex(u => u.id === currentUser.id);
        const targetIdx = users.findIndex(u => u.id === userId);
        
        if (currentIdx === -1 || targetIdx === -1) return;
        
        const isFollowing = users[currentIdx].following.includes(userId);
        if (isFollowing) {
          users[currentIdx].following = users[currentIdx].following.filter(id => id !== userId);
          users[targetIdx].followers = users[targetIdx].followers.filter(id => id !== currentUser.id);
          Utils.showToast('Unfollowed');
        } else {
          users[currentIdx].following.push(userId);
          users[targetIdx].followers.push(currentUser.id);
          Utils.showToast('Following!');
        }
        DB.saveUsers(users);
        currentUser = users[currentIdx];
        DB.saveCurrentUser(currentUser);
        Router.handle();
      }
    };

    const Dev = {
      deleteUser(userId) {
        if (!confirm('Delete this user permanently?')) return;
        let users = DB.getUsers().filter(u => u.id !== userId);
        DB.saveUsers(users);
        Utils.showToast('User deleted');
        Views.showDevPanel();
      },
      purgeAll() {
        if (!confirm('üí• DELETE EVERYTHING?\n\nType PURGE to confirm:')) return;
        if (prompt('Type PURGE to confirm:') !== 'PURGE') return;
        
        localStorage.removeItem(DB.KEYS.USERS);
        localStorage.removeItem(DB.KEYS.POSTS);
        localStorage.removeItem(DB.KEYS.CURRENT_USER);
        localStorage.removeItem('ns_dev_unlocked');
        Utils.showToast('All data purged', 'error');
        setTimeout(() => location.reload(), 1000);
      }
    };

    // Init
    window.addEventListener('DOMContentLoaded', () => {
      Router.handle();
    });
    window.addEventListener('hashchange', () => {
      Router.handle();
    });

    // Expose globals
    window.Router = Router;
    window.Auth = Auth;
    window.Users = Users;
    window.Dev = Dev;
  </script>
</body>
</html>
